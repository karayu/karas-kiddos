"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/content/generate/route";
exports.ids = ["app/api/content/generate/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcontent%2Fgenerate%2Froute&page=%2Fapi%2Fcontent%2Fgenerate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcontent%2Fgenerate%2Froute.ts&appDir=%2FUsers%2Fkarayu%2Fprojects%2Fkaraskiddos%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkarayu%2Fprojects%2Fkaraskiddos&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcontent%2Fgenerate%2Froute&page=%2Fapi%2Fcontent%2Fgenerate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcontent%2Fgenerate%2Froute.ts&appDir=%2FUsers%2Fkarayu%2Fprojects%2Fkaraskiddos%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkarayu%2Fprojects%2Fkaraskiddos&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_karayu_projects_karaskiddos_app_api_content_generate_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/content/generate/route.ts */ \"(rsc)/./app/api/content/generate/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/content/generate/route\",\n        pathname: \"/api/content/generate\",\n        filename: \"route\",\n        bundlePath: \"app/api/content/generate/route\"\n    },\n    resolvedPagePath: \"/Users/karayu/projects/karaskiddos/app/api/content/generate/route.ts\",\n    nextConfigOutput,\n    userland: _Users_karayu_projects_karaskiddos_app_api_content_generate_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/content/generate/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZjb250ZW50JTJGZ2VuZXJhdGUlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmNvbnRlbnQlMkZnZW5lcmF0ZSUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmNvbnRlbnQlMkZnZW5lcmF0ZSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmthcmF5dSUyRnByb2plY3RzJTJGa2FyYXNraWRkb3MlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGa2FyYXl1JTJGcHJvamVjdHMlMkZrYXJhc2tpZGRvcyZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDb0I7QUFDakc7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9rYXJhc2tpZGRvcy8/Zjg1ZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMva2FyYXl1L3Byb2plY3RzL2thcmFza2lkZG9zL2FwcC9hcGkvY29udGVudC9nZW5lcmF0ZS9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvY29udGVudC9nZW5lcmF0ZS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2NvbnRlbnQvZ2VuZXJhdGVcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2NvbnRlbnQvZ2VuZXJhdGUvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMva2FyYXl1L3Byb2plY3RzL2thcmFza2lkZG9zL2FwcC9hcGkvY29udGVudC9nZW5lcmF0ZS9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvY29udGVudC9nZW5lcmF0ZS9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcontent%2Fgenerate%2Froute&page=%2Fapi%2Fcontent%2Fgenerate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcontent%2Fgenerate%2Froute.ts&appDir=%2FUsers%2Fkarayu%2Fprojects%2Fkaraskiddos%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkarayu%2Fprojects%2Fkaraskiddos&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/content/generate/route.ts":
/*!*******************************************!*\
  !*** ./app/api/content/generate/route.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_supabase_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/supabase/server */ \"(rsc)/./lib/supabase/server.ts\");\n/* harmony import */ var _lib_gemini__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/gemini */ \"(rsc)/./lib/gemini.ts\");\n\n\n\nasync function POST(req) {\n    try {\n        if (!process.env.GEMINI_API_KEY) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"GEMINI_API_KEY not configured\"\n            }, {\n                status: 500\n            });\n        }\n        if ( false || !process.env.SUPABASE_SERVICE_ROLE_KEY) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Supabase not configured\"\n            }, {\n                status: 500\n            });\n        }\n        const body = await req.json();\n        const db = (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_1__.getServiceClient)();\n        // For checklist type, generate an image using Gemini 2.5 Flash\n        if (body.type === \"checklist\") {\n            // Get favorite thing and routine items from form data\n            const favoriteThing = body.favoriteThing || \"unicorn\";\n            const routineItems = body.routineItems && body.routineItems.length > 0 ? body.routineItems.filter((item)=>item.trim() !== \"\") : [\n                \"brush teeth\",\n                \"put on pajamas\",\n                \"read book\"\n            ];\n            // Build the checklist name\n            const checklistName = `Rhea the ${favoriteThing} goes to bed`;\n            // Build the imagery descriptions for each routine item with colorful descriptions\n            const imageryDescriptions = routineItems.map((item, index)=>{\n                const itemNum = index + 1;\n                const isFirst = index === 0;\n                const isLast = index === routineItems.length - 1;\n                // Add colorful descriptions based on position\n                let description = \"\";\n                if (isFirst) {\n                    description = `with a proud smile on their face. Use bright colorful colors.`;\n                } else if (isLast) {\n                    // Special handling for reading/book items\n                    if (item.toLowerCase().includes(\"read\") || item.toLowerCase().includes(\"book\")) {\n                        description = `in bed with their eyes closed, looking peaceful and sleepy.`;\n                    } else {\n                        description = `with a happy, content expression.`;\n                    }\n                } else if (index === 1) {\n                    description = `but struggling with it, looking determined.`;\n                } else {\n                    description = `with focused concentration.`;\n                }\n                return `${itemNum}) On the ${isFirst ? \"first\" : isLast && routineItems.length > 2 ? \"last\" : itemNum === 2 ? \"second\" : `${itemNum}th`} row, it should show the ${favoriteThing} ${item} ${description}`;\n            }).join(\"\\n\\n\");\n            const imagePrompt = `Create an illustrated checklist. This checklist should have a whimsical theme, appropriate for looking fun/exciting to a 5 year old. Make the protagonist a ${favoriteThing}, excited to do each of the steps. Make it look professionally illustrated by a children's book author like Hollie Mengert.\n\nThe name of the checklist should be: ${checklistName}\n\nOn the left column, the checklist should have imagery:\n\n${imageryDescriptions}\n\nMake the ${favoriteThing} images take up half the page.\n\nOn the right column, it should just feature ${routineItems.length} blank rows (so that the child can write in them)\n\nMake it good!`;\n            console.log(\"Image Prompt:\", imagePrompt);\n            console.log(\"======================\");\n            // Use Gemini 2.5 Flash Image for image generation\n            // Reference: https://ai.google.dev/gemini-api/docs/image-generation#javascript\n            let imageUrl = null;\n            try {\n                const genAI = (0,_lib_gemini__WEBPACK_IMPORTED_MODULE_2__.getGemini)();\n                // Use the correct model name for image generation\n                const model = genAI.getGenerativeModel({\n                    model: \"gemini-2.5-flash-image\"\n                });\n                console.log(\"=== Calling Gemini for Image Generation ===\");\n                console.log(\"Model: gemini-2.5-flash-image\");\n                console.log(\"Image Prompt:\", imagePrompt);\n                // Generate image using Gemini 2.5 Flash Image\n                const completion = await model.generateContent(imagePrompt);\n                const response = completion.response;\n                console.log(\"=== Gemini Response ===\");\n                console.log(\"Candidates:\", response.candidates?.length);\n                // Check for image data in the response parts\n                let base64Image = null;\n                // Iterate through all parts in the response\n                if (response.candidates?.[0]?.content?.parts) {\n                    for (const part of response.candidates[0].content.parts){\n                        console.log(\"Part keys:\", Object.keys(part));\n                        // Check for inlineData (image data)\n                        if (part.inlineData) {\n                            base64Image = part.inlineData.data;\n                            console.log(\"Found image in inlineData, mimeType:\", part.inlineData.mimeType);\n                            break; // Found the image, no need to check other parts\n                        }\n                        // Check for text (might contain image description or URL)\n                        if (part.text) {\n                            console.log(\"Part text preview:\", part.text.substring(0, 200));\n                        }\n                    }\n                }\n                console.log(\"Base64 image found:\", base64Image ? \"Yes\" : \"No\");\n                console.log(\"======================\");\n                // If we have a base64 image, save it to Supabase Storage\n                if (base64Image) {\n                    try {\n                        const imageBuffer = Buffer.from(base64Image, \"base64\");\n                        const fileName = `checklists/${Date.now()}-${Math.random().toString(36).substring(7)}.png`;\n                        const { data: uploadData, error: uploadError } = await db.storage.from(\"checklists\").upload(fileName, imageBuffer, {\n                            contentType: \"image/png\",\n                            upsert: false\n                        });\n                        if (!uploadError && uploadData) {\n                            const { data: urlData } = db.storage.from(\"checklists\").getPublicUrl(fileName);\n                            imageUrl = urlData.publicUrl;\n                            console.log(\"Image saved to Supabase Storage:\", imageUrl);\n                            console.log(\"\\uD83D\\uDD17 Direct link to generated image:\", imageUrl);\n                        } else {\n                            console.error(\"Storage upload error:\", uploadError);\n                            // Fallback to data URL if storage fails\n                            imageUrl = `data:image/png;base64,${base64Image}`;\n                        }\n                    } catch (storageError) {\n                        console.error(\"Storage error:\", storageError);\n                        imageUrl = `data:image/png;base64,${base64Image}`;\n                    }\n                } else {\n                    console.log(\"No image data found in Gemini response\");\n                }\n            } catch (imageError) {\n                console.error(\"Image generation error:\", imageError.message || imageError);\n            // Continue without image - we'll still create the checklist\n            }\n            // Build steps from the same routineItems we used for the image prompt\n            const steps = routineItems.map((item)=>({\n                    label: item.trim(),\n                    tip: `Great job on ${item.trim()}!`\n                }));\n            const parsed = {\n                title: checklistName,\n                steps,\n                image_url: imageUrl,\n                image_prompt: imagePrompt\n            };\n            try {\n                const { data: inserted, error } = await db.from(\"content_items\").insert({\n                    profile_id: null,\n                    child_id: null,\n                    title: parsed.title,\n                    category: body.category,\n                    type: body.type,\n                    body: parsed,\n                    cover_url: imageUrl,\n                    is_public: true\n                }).select().single();\n                if (error) {\n                    console.error(\"Database insert error:\", error);\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: error.message\n                    }, {\n                        status: 500\n                    });\n                }\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    content: inserted\n                });\n            } catch (dbError) {\n                console.error(\"Database error:\", dbError);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: dbError.message || \"Database error\"\n                }, {\n                    status: 500\n                });\n            }\n        }\n        // For storybook type, generate a 10-page illustrated storybook\n        if (body.type === \"storybook\") {\n            const genAI = (0,_lib_gemini__WEBPACK_IMPORTED_MODULE_2__.getGemini)();\n            const textModel = genAI.getGenerativeModel({\n                model: \"gemini-2.5-flash\"\n            });\n            const imageModel = genAI.getGenerativeModel({\n                model: \"gemini-2.5-flash-image\"\n            });\n            const basePrompt = body.prompt || \"Create a fun, entertaining story for a 5-year-old with a conflict that gets resolved at the end.\";\n            // Step 1: Generate the story structure (10 pages)\n            const storyPrompt = `${basePrompt}\n\nCreate a professional, whimsical 10-page storybook for a 5-year-old child. The story should:\n- Have a clear conflict that gets resolved by the end\n- Be entertaining and age-appropriate\n- Be professional and whimsical in style\n- Each page should have 2-3 sentences of text\n\nReturn ONLY valid JSON in this exact format:\n{\n  \"title\": \"Story Title\",\n  \"pages\": [\n    {\"pageNumber\": 1, \"text\": \"Page 1 text here\", \"imageDescription\": \"Detailed description of what should be illustrated on this page\"},\n    {\"pageNumber\": 2, \"text\": \"Page 2 text here\", \"imageDescription\": \"Detailed description...\"},\n    ... (10 pages total)\n  ]\n}\n\nImportant: Return ONLY the JSON object, no markdown code blocks, no explanation text.`;\n            console.log(\"=== Generating Storybook Structure ===\");\n            const storyCompletion = await textModel.generateContent(storyPrompt);\n            let storyText = storyCompletion.response.text();\n            // Clean up markdown code blocks\n            storyText = storyText.trim();\n            if (storyText.startsWith(\"```json\")) {\n                storyText = storyText.replace(/^```json\\s*/, \"\").replace(/\\s*```$/, \"\");\n            } else if (storyText.startsWith(\"```\")) {\n                storyText = storyText.replace(/^```\\s*/, \"\").replace(/\\s*```$/, \"\");\n            }\n            let storyData;\n            try {\n                storyData = JSON.parse(storyText);\n            } catch (parseError) {\n                console.error(\"Story JSON parse error:\", parseError);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Failed to parse story structure\"\n                }, {\n                    status: 500\n                });\n            }\n            if (!storyData.pages || storyData.pages.length !== 10) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Story must have exactly 10 pages\"\n                }, {\n                    status: 500\n                });\n            }\n            console.log(`Generated story structure: ${storyData.title} with ${storyData.pages.length} pages`);\n            // Step 2: Generate images for each page\n            const pagesWithImages = [];\n            let coverImageUrl = null;\n            for(let i = 0; i < storyData.pages.length; i++){\n                const page = storyData.pages[i];\n                console.log(`Generating image for page ${page.pageNumber}...`);\n                const imagePrompt = `Create a professional, whimsical children's book illustration. Style: colorful, playful, suitable for a 5-year-old, like a high-quality picture book by authors like Eric Carle or Julia Donaldson. \n\n${page.imageDescription}\n\nMake it bright, engaging, and professional. The illustration should fill the entire image and be suitable for a storybook page.`;\n                try {\n                    const imageCompletion = await imageModel.generateContent(imagePrompt);\n                    const imageResponse = imageCompletion.response;\n                    let base64Image = null;\n                    // Extract image from response\n                    if (imageResponse.candidates?.[0]?.content?.parts) {\n                        for (const part of imageResponse.candidates[0].content.parts){\n                            if (part.inlineData) {\n                                base64Image = part.inlineData.data;\n                                break;\n                            }\n                        }\n                    }\n                    if (base64Image) {\n                        // Save to Supabase Storage\n                        const imageBuffer = Buffer.from(base64Image, \"base64\");\n                        const fileName = `storybooks/${Date.now()}-${Math.random().toString(36).substring(7)}-page-${page.pageNumber}.png`;\n                        const { data: uploadData, error: uploadError } = await db.storage.from(\"checklists\") // Using checklists bucket for now, could create a storybooks bucket\n                        .upload(fileName, imageBuffer, {\n                            contentType: \"image/png\",\n                            upsert: false\n                        });\n                        if (!uploadError && uploadData) {\n                            const { data: urlData } = db.storage.from(\"checklists\").getPublicUrl(fileName);\n                            const imageUrl = urlData.publicUrl;\n                            pagesWithImages.push({\n                                pageNumber: page.pageNumber,\n                                text: page.text,\n                                imageUrl: imageUrl,\n                                imageDescription: page.imageDescription\n                            });\n                            // Use first page as cover\n                            if (page.pageNumber === 1) {\n                                coverImageUrl = imageUrl;\n                            }\n                            console.log(`âœ“ Page ${page.pageNumber} image saved: ${imageUrl}`);\n                        } else {\n                            console.error(`Upload error for page ${page.pageNumber}:`, uploadError);\n                            // Continue without image for this page\n                            pagesWithImages.push({\n                                pageNumber: page.pageNumber,\n                                text: page.text,\n                                imageUrl: null,\n                                imageDescription: page.imageDescription\n                            });\n                        }\n                    } else {\n                        console.log(`No image data found for page ${page.pageNumber}`);\n                        pagesWithImages.push({\n                            pageNumber: page.pageNumber,\n                            text: page.text,\n                            imageUrl: null,\n                            imageDescription: page.imageDescription\n                        });\n                    }\n                } catch (imageError) {\n                    console.error(`Image generation error for page ${page.pageNumber}:`, imageError.message);\n                    // Continue without image\n                    pagesWithImages.push({\n                        pageNumber: page.pageNumber,\n                        text: page.text,\n                        imageUrl: null,\n                        imageDescription: page.imageDescription\n                    });\n                }\n                // Add a small delay between image generations to avoid rate limits\n                if (i < storyData.pages.length - 1) {\n                    await new Promise((resolve)=>setTimeout(resolve, 500));\n                }\n            }\n            // Step 3: Save storybook to database\n            const storybookData = {\n                title: storyData.title,\n                pages: pagesWithImages,\n                originalPrompt: basePrompt\n            };\n            try {\n                const { data: inserted, error } = await db.from(\"content_items\").insert({\n                    profile_id: null,\n                    child_id: null,\n                    title: storybookData.title,\n                    category: body.category,\n                    type: \"story\",\n                    body: storybookData,\n                    cover_url: coverImageUrl,\n                    is_public: true\n                }).select().single();\n                if (error) {\n                    console.error(\"Database insert error:\", error);\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: error.message\n                    }, {\n                        status: 500\n                    });\n                }\n                console.log(\"=== Storybook Generated Successfully ===\");\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    content: inserted\n                });\n            } catch (dbError) {\n                console.error(\"Database error:\", dbError);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: dbError.message || \"Database error\"\n                }, {\n                    status: 500\n                });\n            }\n        }\n        // For other types, use text generation with Gemini\n        const genAI = (0,_lib_gemini__WEBPACK_IMPORTED_MODULE_2__.getGemini)();\n        const model = genAI.getGenerativeModel({\n            model: \"gemini-2.5-flash\"\n        });\n        let fullPrompt = \"You are a helper for parents of young children.\\n\\n\";\n        const basePrompt = body.prompt ?? \"Create a supportive, age-appropriate piece for a preschooler.\";\n        if (body.type === \"story\") {\n            fullPrompt += `${basePrompt}\\n\\nCreate a supportive personalized story for a child about this situation. Return ONLY valid JSON in this exact format: {\"title\": \"Story Title\", \"outline\": [\"point 1\", \"point 2\"], \"story_html\": \"<p>Full story HTML here</p>\"}`;\n        } else if (body.type === \"song_lyrics\") {\n            fullPrompt += `${basePrompt}\\n\\nCreate playful bedtime song lyrics only. Return ONLY valid JSON: {\"title\": \"Song Title\", \"lyrics\": \"Full lyrics text\", \"style\": \"lullaby\"}`;\n        } else if (body.type === \"schedule\" || body.type === \"calendar\") {\n            fullPrompt += `${basePrompt}\\n\\nCreate a simple schedule. Return ONLY valid JSON: {\"title\": \"Schedule Title\", \"items\": [{\"time\": \"9:00 AM\", \"label\": \"Activity\"}]}`;\n        }\n        fullPrompt += \"\\n\\nImportant: Return ONLY the JSON object, no markdown code blocks, no explanation text.\";\n        const completion = await model.generateContent(fullPrompt);\n        let text = completion.response.text();\n        // Clean up markdown code blocks if present\n        text = text.trim();\n        if (text.startsWith(\"```json\")) {\n            text = text.replace(/^```json\\s*/, \"\").replace(/\\s*```$/, \"\");\n        } else if (text.startsWith(\"```\")) {\n            text = text.replace(/^```\\s*/, \"\").replace(/\\s*```$/, \"\");\n        }\n        let parsed;\n        try {\n            parsed = JSON.parse(text);\n        } catch (parseError) {\n            console.error(\"JSON parse error:\", parseError, \"Text was:\", text.substring(0, 200));\n            // Fallback: create a simple structure\n            parsed = {\n                title: \"Generated Story\",\n                outline: [\n                    \"Introduction\",\n                    \"Main story\",\n                    \"Conclusion\"\n                ],\n                story_html: `<p>${text.replace(/\\n/g, \"</p><p>\")}</p>`\n            };\n        }\n        const { data: inserted, error } = await db.from(\"content_items\").insert({\n            profile_id: null,\n            child_id: null,\n            title: parsed.title ?? \"Generated\",\n            category: body.category,\n            type: body.type,\n            body: parsed,\n            is_public: true\n        }).select().single();\n        if (error) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: error.message\n        }, {\n            status: 500\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            content: inserted\n        });\n    } catch (e) {\n        console.error(\"Generate error:\", e);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: e.message || \"Generation failed\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFBSSxDQUFDO1lBQUVDLE9BQU9BLE1BQU1rRSxPQUFPO1FBQUMsR0FBRztZQUFFakUsUUFBUTtRQUFJO1FBQzVFLE9BQU9WLHFEQUFZQSxDQUFDUSxJQUFJLENBQUM7WUFBRXFDLFNBQVNzQztRQUFTO0lBQy9DLEVBQUUsT0FBT3lDLEdBQVE7UUFDZjFGLFFBQVF6QixLQUFLLENBQUMsbUJBQW1CbUg7UUFDakMsT0FBTzVILHFEQUFZQSxDQUFDUSxJQUFJLENBQUM7WUFBRUMsT0FBT21ILEVBQUVqRCxPQUFPLElBQUk7UUFBb0IsR0FBRztZQUFFakUsUUFBUTtRQUFJO0lBQ3RGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9rYXJhc2tpZGRvcy8uL2FwcC9hcGkvY29udGVudC9nZW5lcmF0ZS9yb3V0ZS50cz8yNmJiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuaW1wb3J0IHsgZ2V0U2VydmljZUNsaWVudCB9IGZyb20gXCJAL2xpYi9zdXBhYmFzZS9zZXJ2ZXJcIjtcbmltcG9ydCB7IGdldEdlbWluaSB9IGZyb20gXCJAL2xpYi9nZW1pbmlcIjtcblxudHlwZSBHZW5lcmF0ZUJvZHkgPSB7XG4gIGNhdGVnb3J5OiBcImJlZHRpbWVcIiB8IFwiZ2V0dGluZ19vdXRfdGhlX2Rvb3JcIiB8IFwiY2hvcmVzXCIgfCBcIm5ld19zaXR1YXRpb25zXCI7XG4gIHR5cGU6IFwiY2hlY2tsaXN0XCIgfCBcInN0b3J5XCIgfCBcInNvbmdfbHlyaWNzXCIgfCBcInNjaGVkdWxlXCIgfCBcImNhbGVuZGFyXCIgfCBcInN0b3J5Ym9va1wiO1xuICBjaGlsZElkPzogc3RyaW5nO1xuICBwcm9tcHQ/OiBzdHJpbmc7XG4gIC8vIFJhdyBmb3JtIGRhdGEgZm9yIGNoZWNrbGlzdHNcbiAgZmF2b3JpdGVUaGluZz86IHN0cmluZztcbiAgcm91dGluZUl0ZW1zPzogc3RyaW5nW107XG59O1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXE6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBpZiAoIXByb2Nlc3MuZW52LkdFTUlOSV9BUElfS0VZKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJHRU1JTklfQVBJX0tFWSBub3QgY29uZmlndXJlZFwiIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gICAgfVxuICAgIGlmICghcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIHx8ICFwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJTdXBhYmFzZSBub3QgY29uZmlndXJlZFwiIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgYm9keSA9IChhd2FpdCByZXEuanNvbigpKSBhcyBHZW5lcmF0ZUJvZHk7XG4gICAgY29uc3QgZGIgPSBnZXRTZXJ2aWNlQ2xpZW50KCk7XG5cbiAgICAvLyBGb3IgY2hlY2tsaXN0IHR5cGUsIGdlbmVyYXRlIGFuIGltYWdlIHVzaW5nIEdlbWluaSAyLjUgRmxhc2hcbiAgICBpZiAoYm9keS50eXBlID09PSBcImNoZWNrbGlzdFwiKSB7XG4gICAgICAvLyBHZXQgZmF2b3JpdGUgdGhpbmcgYW5kIHJvdXRpbmUgaXRlbXMgZnJvbSBmb3JtIGRhdGFcbiAgICAgIGNvbnN0IGZhdm9yaXRlVGhpbmcgPSBib2R5LmZhdm9yaXRlVGhpbmcgfHwgXCJ1bmljb3JuXCI7XG4gICAgICBjb25zdCByb3V0aW5lSXRlbXMgPSBib2R5LnJvdXRpbmVJdGVtcyAmJiBib2R5LnJvdXRpbmVJdGVtcy5sZW5ndGggPiAwIFxuICAgICAgICA/IGJvZHkucm91dGluZUl0ZW1zLmZpbHRlcigoaXRlbTogc3RyaW5nKSA9PiBpdGVtLnRyaW0oKSAhPT0gXCJcIilcbiAgICAgICAgOiBbXCJicnVzaCB0ZWV0aFwiLCBcInB1dCBvbiBwYWphbWFzXCIsIFwicmVhZCBib29rXCJdO1xuICAgICAgXG4gICAgICAvLyBCdWlsZCB0aGUgY2hlY2tsaXN0IG5hbWVcbiAgICAgIGNvbnN0IGNoZWNrbGlzdE5hbWUgPSBgUmhlYSB0aGUgJHtmYXZvcml0ZVRoaW5nfSBnb2VzIHRvIGJlZGA7XG4gICAgICBcbiAgICAgIC8vIEJ1aWxkIHRoZSBpbWFnZXJ5IGRlc2NyaXB0aW9ucyBmb3IgZWFjaCByb3V0aW5lIGl0ZW0gd2l0aCBjb2xvcmZ1bCBkZXNjcmlwdGlvbnNcbiAgICAgIGNvbnN0IGltYWdlcnlEZXNjcmlwdGlvbnMgPSByb3V0aW5lSXRlbXMubWFwKChpdGVtOiBzdHJpbmcsIGluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgICAgY29uc3QgaXRlbU51bSA9IGluZGV4ICsgMTtcbiAgICAgICAgY29uc3QgaXNGaXJzdCA9IGluZGV4ID09PSAwO1xuICAgICAgICBjb25zdCBpc0xhc3QgPSBpbmRleCA9PT0gcm91dGluZUl0ZW1zLmxlbmd0aCAtIDE7XG4gICAgICAgIFxuICAgICAgICAvLyBBZGQgY29sb3JmdWwgZGVzY3JpcHRpb25zIGJhc2VkIG9uIHBvc2l0aW9uXG4gICAgICAgIGxldCBkZXNjcmlwdGlvbiA9IFwiXCI7XG4gICAgICAgIGlmIChpc0ZpcnN0KSB7XG4gICAgICAgICAgZGVzY3JpcHRpb24gPSBgd2l0aCBhIHByb3VkIHNtaWxlIG9uIHRoZWlyIGZhY2UuIFVzZSBicmlnaHQgY29sb3JmdWwgY29sb3JzLmA7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNMYXN0KSB7XG4gICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgcmVhZGluZy9ib29rIGl0ZW1zXG4gICAgICAgICAgaWYgKGl0ZW0udG9Mb3dlckNhc2UoKS5pbmNsdWRlcygncmVhZCcpIHx8IGl0ZW0udG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnYm9vaycpKSB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbiA9IGBpbiBiZWQgd2l0aCB0aGVpciBleWVzIGNsb3NlZCwgbG9va2luZyBwZWFjZWZ1bCBhbmQgc2xlZXB5LmA7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gYHdpdGggYSBoYXBweSwgY29udGVudCBleHByZXNzaW9uLmA7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGluZGV4ID09PSAxKSB7XG4gICAgICAgICAgZGVzY3JpcHRpb24gPSBgYnV0IHN0cnVnZ2xpbmcgd2l0aCBpdCwgbG9va2luZyBkZXRlcm1pbmVkLmA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGVzY3JpcHRpb24gPSBgd2l0aCBmb2N1c2VkIGNvbmNlbnRyYXRpb24uYDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGAke2l0ZW1OdW19KSBPbiB0aGUgJHtpc0ZpcnN0ID8gJ2ZpcnN0JyA6IGlzTGFzdCAmJiByb3V0aW5lSXRlbXMubGVuZ3RoID4gMiA/ICdsYXN0JyA6IGl0ZW1OdW0gPT09IDIgPyAnc2Vjb25kJyA6IGAke2l0ZW1OdW19dGhgfSByb3csIGl0IHNob3VsZCBzaG93IHRoZSAke2Zhdm9yaXRlVGhpbmd9ICR7aXRlbX0gJHtkZXNjcmlwdGlvbn1gO1xuICAgICAgfSkuam9pbignXFxuXFxuJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IGltYWdlUHJvbXB0ID0gYENyZWF0ZSBhbiBpbGx1c3RyYXRlZCBjaGVja2xpc3QuIFRoaXMgY2hlY2tsaXN0IHNob3VsZCBoYXZlIGEgd2hpbXNpY2FsIHRoZW1lLCBhcHByb3ByaWF0ZSBmb3IgbG9va2luZyBmdW4vZXhjaXRpbmcgdG8gYSA1IHllYXIgb2xkLiBNYWtlIHRoZSBwcm90YWdvbmlzdCBhICR7ZmF2b3JpdGVUaGluZ30sIGV4Y2l0ZWQgdG8gZG8gZWFjaCBvZiB0aGUgc3RlcHMuIE1ha2UgaXQgbG9vayBwcm9mZXNzaW9uYWxseSBpbGx1c3RyYXRlZCBieSBhIGNoaWxkcmVuJ3MgYm9vayBhdXRob3IgbGlrZSBIb2xsaWUgTWVuZ2VydC5cblxuVGhlIG5hbWUgb2YgdGhlIGNoZWNrbGlzdCBzaG91bGQgYmU6ICR7Y2hlY2tsaXN0TmFtZX1cblxuT24gdGhlIGxlZnQgY29sdW1uLCB0aGUgY2hlY2tsaXN0IHNob3VsZCBoYXZlIGltYWdlcnk6XG5cbiR7aW1hZ2VyeURlc2NyaXB0aW9uc31cblxuTWFrZSB0aGUgJHtmYXZvcml0ZVRoaW5nfSBpbWFnZXMgdGFrZSB1cCBoYWxmIHRoZSBwYWdlLlxuXG5PbiB0aGUgcmlnaHQgY29sdW1uLCBpdCBzaG91bGQganVzdCBmZWF0dXJlICR7cm91dGluZUl0ZW1zLmxlbmd0aH0gYmxhbmsgcm93cyAoc28gdGhhdCB0aGUgY2hpbGQgY2FuIHdyaXRlIGluIHRoZW0pXG5cbk1ha2UgaXQgZ29vZCFgO1xuXG4gICAgICBjb25zb2xlLmxvZyhcIkltYWdlIFByb21wdDpcIiwgaW1hZ2VQcm9tcHQpO1xuICAgICAgY29uc29sZS5sb2coXCI9PT09PT09PT09PT09PT09PT09PT09XCIpO1xuXG4gICAgICAvLyBVc2UgR2VtaW5pIDIuNSBGbGFzaCBJbWFnZSBmb3IgaW1hZ2UgZ2VuZXJhdGlvblxuICAgICAgLy8gUmVmZXJlbmNlOiBodHRwczovL2FpLmdvb2dsZS5kZXYvZ2VtaW5pLWFwaS9kb2NzL2ltYWdlLWdlbmVyYXRpb24jamF2YXNjcmlwdFxuICAgICAgXG4gICAgICBsZXQgaW1hZ2VVcmw6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICAgICAgXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBnZW5BSSA9IGdldEdlbWluaSgpO1xuICAgICAgICAvLyBVc2UgdGhlIGNvcnJlY3QgbW9kZWwgbmFtZSBmb3IgaW1hZ2UgZ2VuZXJhdGlvblxuICAgICAgICBjb25zdCBtb2RlbCA9IGdlbkFJLmdldEdlbmVyYXRpdmVNb2RlbCh7IFxuICAgICAgICAgIG1vZGVsOiBcImdlbWluaS0yLjUtZmxhc2gtaW1hZ2VcIlxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKFwiPT09IENhbGxpbmcgR2VtaW5pIGZvciBJbWFnZSBHZW5lcmF0aW9uID09PVwiKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJNb2RlbDogZ2VtaW5pLTIuNS1mbGFzaC1pbWFnZVwiKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJJbWFnZSBQcm9tcHQ6XCIsIGltYWdlUHJvbXB0KTtcbiAgICAgICAgXG4gICAgICAgIC8vIEdlbmVyYXRlIGltYWdlIHVzaW5nIEdlbWluaSAyLjUgRmxhc2ggSW1hZ2VcbiAgICAgICAgY29uc3QgY29tcGxldGlvbiA9IGF3YWl0IG1vZGVsLmdlbmVyYXRlQ29udGVudChpbWFnZVByb21wdCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGNvbXBsZXRpb24ucmVzcG9uc2U7XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZyhcIj09PSBHZW1pbmkgUmVzcG9uc2UgPT09XCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIkNhbmRpZGF0ZXM6XCIsIHJlc3BvbnNlLmNhbmRpZGF0ZXM/Lmxlbmd0aCk7XG4gICAgICAgIFxuICAgICAgICAvLyBDaGVjayBmb3IgaW1hZ2UgZGF0YSBpbiB0aGUgcmVzcG9uc2UgcGFydHNcbiAgICAgICAgbGV0IGJhc2U2NEltYWdlOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgICAgICAgXG4gICAgICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBhbGwgcGFydHMgaW4gdGhlIHJlc3BvbnNlXG4gICAgICAgIGlmIChyZXNwb25zZS5jYW5kaWRhdGVzPy5bMF0/LmNvbnRlbnQ/LnBhcnRzKSB7XG4gICAgICAgICAgZm9yIChjb25zdCBwYXJ0IG9mIHJlc3BvbnNlLmNhbmRpZGF0ZXNbMF0uY29udGVudC5wYXJ0cykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJQYXJ0IGtleXM6XCIsIE9iamVjdC5rZXlzKHBhcnQpKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIGlubGluZURhdGEgKGltYWdlIGRhdGEpXG4gICAgICAgICAgICBpZiAocGFydC5pbmxpbmVEYXRhKSB7XG4gICAgICAgICAgICAgIGJhc2U2NEltYWdlID0gcGFydC5pbmxpbmVEYXRhLmRhdGE7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRm91bmQgaW1hZ2UgaW4gaW5saW5lRGF0YSwgbWltZVR5cGU6XCIsIHBhcnQuaW5saW5lRGF0YS5taW1lVHlwZSk7XG4gICAgICAgICAgICAgIGJyZWFrOyAvLyBGb3VuZCB0aGUgaW1hZ2UsIG5vIG5lZWQgdG8gY2hlY2sgb3RoZXIgcGFydHNcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIHRleHQgKG1pZ2h0IGNvbnRhaW4gaW1hZ2UgZGVzY3JpcHRpb24gb3IgVVJMKVxuICAgICAgICAgICAgaWYgKHBhcnQudGV4dCkge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlBhcnQgdGV4dCBwcmV2aWV3OlwiLCBwYXJ0LnRleHQuc3Vic3RyaW5nKDAsIDIwMCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coXCJCYXNlNjQgaW1hZ2UgZm91bmQ6XCIsIGJhc2U2NEltYWdlID8gXCJZZXNcIiA6IFwiTm9cIik7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiPT09PT09PT09PT09PT09PT09PT09PVwiKTtcblxuICAgICAgICAvLyBJZiB3ZSBoYXZlIGEgYmFzZTY0IGltYWdlLCBzYXZlIGl0IHRvIFN1cGFiYXNlIFN0b3JhZ2VcbiAgICAgICAgaWYgKGJhc2U2NEltYWdlKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGltYWdlQnVmZmVyID0gQnVmZmVyLmZyb20oYmFzZTY0SW1hZ2UsIFwiYmFzZTY0XCIpO1xuICAgICAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBgY2hlY2tsaXN0cy8ke0RhdGUubm93KCl9LSR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDcpfS5wbmdgO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCB7IGRhdGE6IHVwbG9hZERhdGEsIGVycm9yOiB1cGxvYWRFcnJvciB9ID0gYXdhaXQgZGIuc3RvcmFnZVxuICAgICAgICAgICAgICAuZnJvbShcImNoZWNrbGlzdHNcIilcbiAgICAgICAgICAgICAgLnVwbG9hZChmaWxlTmFtZSwgaW1hZ2VCdWZmZXIsIHtcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogXCJpbWFnZS9wbmdcIixcbiAgICAgICAgICAgICAgICB1cHNlcnQ6IGZhbHNlLFxuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKCF1cGxvYWRFcnJvciAmJiB1cGxvYWREYXRhKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHsgZGF0YTogdXJsRGF0YSB9ID0gZGIuc3RvcmFnZVxuICAgICAgICAgICAgICAgIC5mcm9tKFwiY2hlY2tsaXN0c1wiKVxuICAgICAgICAgICAgICAgIC5nZXRQdWJsaWNVcmwoZmlsZU5hbWUpO1xuICAgICAgICAgICAgICBpbWFnZVVybCA9IHVybERhdGEucHVibGljVXJsO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkltYWdlIHNhdmVkIHRvIFN1cGFiYXNlIFN0b3JhZ2U6XCIsIGltYWdlVXJsKTtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXCLwn5SXIERpcmVjdCBsaW5rIHRvIGdlbmVyYXRlZCBpbWFnZTpcIiwgaW1hZ2VVcmwpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlN0b3JhZ2UgdXBsb2FkIGVycm9yOlwiLCB1cGxvYWRFcnJvcik7XG4gICAgICAgICAgICAgIC8vIEZhbGxiYWNrIHRvIGRhdGEgVVJMIGlmIHN0b3JhZ2UgZmFpbHNcbiAgICAgICAgICAgICAgaW1hZ2VVcmwgPSBgZGF0YTppbWFnZS9wbmc7YmFzZTY0LCR7YmFzZTY0SW1hZ2V9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChzdG9yYWdlRXJyb3I6IGFueSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlN0b3JhZ2UgZXJyb3I6XCIsIHN0b3JhZ2VFcnJvcik7XG4gICAgICAgICAgICBpbWFnZVVybCA9IGBkYXRhOmltYWdlL3BuZztiYXNlNjQsJHtiYXNlNjRJbWFnZX1gO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIk5vIGltYWdlIGRhdGEgZm91bmQgaW4gR2VtaW5pIHJlc3BvbnNlXCIpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChpbWFnZUVycm9yOiBhbnkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkltYWdlIGdlbmVyYXRpb24gZXJyb3I6XCIsIGltYWdlRXJyb3IubWVzc2FnZSB8fCBpbWFnZUVycm9yKTtcbiAgICAgICAgLy8gQ29udGludWUgd2l0aG91dCBpbWFnZSAtIHdlJ2xsIHN0aWxsIGNyZWF0ZSB0aGUgY2hlY2tsaXN0XG4gICAgICB9XG5cbiAgICAgIC8vIEJ1aWxkIHN0ZXBzIGZyb20gdGhlIHNhbWUgcm91dGluZUl0ZW1zIHdlIHVzZWQgZm9yIHRoZSBpbWFnZSBwcm9tcHRcbiAgICAgIGNvbnN0IHN0ZXBzID0gcm91dGluZUl0ZW1zLm1hcCgoaXRlbTogc3RyaW5nKSA9PiAoe1xuICAgICAgICBsYWJlbDogaXRlbS50cmltKCksXG4gICAgICAgIHRpcDogYEdyZWF0IGpvYiBvbiAke2l0ZW0udHJpbSgpfSFgLFxuICAgICAgfSkpO1xuXG4gICAgICBjb25zdCBwYXJzZWQgPSB7XG4gICAgICAgIHRpdGxlOiBjaGVja2xpc3ROYW1lLFxuICAgICAgICBzdGVwcyxcbiAgICAgICAgaW1hZ2VfdXJsOiBpbWFnZVVybCxcbiAgICAgICAgaW1hZ2VfcHJvbXB0OiBpbWFnZVByb21wdCxcbiAgICAgIH07XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHsgZGF0YTogaW5zZXJ0ZWQsIGVycm9yIH0gPSBhd2FpdCBkYlxuICAgICAgICAgIC5mcm9tKFwiY29udGVudF9pdGVtc1wiKVxuICAgICAgICAgIC5pbnNlcnQoe1xuICAgICAgICAgICAgcHJvZmlsZV9pZDogbnVsbCxcbiAgICAgICAgICAgIGNoaWxkX2lkOiBudWxsLFxuICAgICAgICAgICAgdGl0bGU6IHBhcnNlZC50aXRsZSxcbiAgICAgICAgICAgIGNhdGVnb3J5OiBib2R5LmNhdGVnb3J5LFxuICAgICAgICAgICAgdHlwZTogYm9keS50eXBlLFxuICAgICAgICAgICAgYm9keTogcGFyc2VkLFxuICAgICAgICAgICAgY292ZXJfdXJsOiBpbWFnZVVybCxcbiAgICAgICAgICAgIGlzX3B1YmxpYzogdHJ1ZSxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRGF0YWJhc2UgaW5zZXJ0IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBjb250ZW50OiBpbnNlcnRlZCB9KTtcbiAgICAgIH0gY2F0Y2ggKGRiRXJyb3I6IGFueSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRGF0YWJhc2UgZXJyb3I6XCIsIGRiRXJyb3IpO1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogZGJFcnJvci5tZXNzYWdlIHx8IFwiRGF0YWJhc2UgZXJyb3JcIiB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEZvciBzdG9yeWJvb2sgdHlwZSwgZ2VuZXJhdGUgYSAxMC1wYWdlIGlsbHVzdHJhdGVkIHN0b3J5Ym9va1xuICAgIGlmIChib2R5LnR5cGUgPT09IFwic3Rvcnlib29rXCIpIHtcbiAgICAgIGNvbnN0IGdlbkFJID0gZ2V0R2VtaW5pKCk7XG4gICAgICBjb25zdCB0ZXh0TW9kZWwgPSBnZW5BSS5nZXRHZW5lcmF0aXZlTW9kZWwoeyBtb2RlbDogXCJnZW1pbmktMi41LWZsYXNoXCIgfSk7XG4gICAgICBjb25zdCBpbWFnZU1vZGVsID0gZ2VuQUkuZ2V0R2VuZXJhdGl2ZU1vZGVsKHsgbW9kZWw6IFwiZ2VtaW5pLTIuNS1mbGFzaC1pbWFnZVwiIH0pO1xuXG4gICAgICBjb25zdCBiYXNlUHJvbXB0ID0gYm9keS5wcm9tcHQgfHwgXCJDcmVhdGUgYSBmdW4sIGVudGVydGFpbmluZyBzdG9yeSBmb3IgYSA1LXllYXItb2xkIHdpdGggYSBjb25mbGljdCB0aGF0IGdldHMgcmVzb2x2ZWQgYXQgdGhlIGVuZC5cIjtcbiAgICAgIFxuICAgICAgLy8gU3RlcCAxOiBHZW5lcmF0ZSB0aGUgc3Rvcnkgc3RydWN0dXJlICgxMCBwYWdlcylcbiAgICAgIGNvbnN0IHN0b3J5UHJvbXB0ID0gYCR7YmFzZVByb21wdH1cblxuQ3JlYXRlIGEgcHJvZmVzc2lvbmFsLCB3aGltc2ljYWwgMTAtcGFnZSBzdG9yeWJvb2sgZm9yIGEgNS15ZWFyLW9sZCBjaGlsZC4gVGhlIHN0b3J5IHNob3VsZDpcbi0gSGF2ZSBhIGNsZWFyIGNvbmZsaWN0IHRoYXQgZ2V0cyByZXNvbHZlZCBieSB0aGUgZW5kXG4tIEJlIGVudGVydGFpbmluZyBhbmQgYWdlLWFwcHJvcHJpYXRlXG4tIEJlIHByb2Zlc3Npb25hbCBhbmQgd2hpbXNpY2FsIGluIHN0eWxlXG4tIEVhY2ggcGFnZSBzaG91bGQgaGF2ZSAyLTMgc2VudGVuY2VzIG9mIHRleHRcblxuUmV0dXJuIE9OTFkgdmFsaWQgSlNPTiBpbiB0aGlzIGV4YWN0IGZvcm1hdDpcbntcbiAgXCJ0aXRsZVwiOiBcIlN0b3J5IFRpdGxlXCIsXG4gIFwicGFnZXNcIjogW1xuICAgIHtcInBhZ2VOdW1iZXJcIjogMSwgXCJ0ZXh0XCI6IFwiUGFnZSAxIHRleHQgaGVyZVwiLCBcImltYWdlRGVzY3JpcHRpb25cIjogXCJEZXRhaWxlZCBkZXNjcmlwdGlvbiBvZiB3aGF0IHNob3VsZCBiZSBpbGx1c3RyYXRlZCBvbiB0aGlzIHBhZ2VcIn0sXG4gICAge1wicGFnZU51bWJlclwiOiAyLCBcInRleHRcIjogXCJQYWdlIDIgdGV4dCBoZXJlXCIsIFwiaW1hZ2VEZXNjcmlwdGlvblwiOiBcIkRldGFpbGVkIGRlc2NyaXB0aW9uLi4uXCJ9LFxuICAgIC4uLiAoMTAgcGFnZXMgdG90YWwpXG4gIF1cbn1cblxuSW1wb3J0YW50OiBSZXR1cm4gT05MWSB0aGUgSlNPTiBvYmplY3QsIG5vIG1hcmtkb3duIGNvZGUgYmxvY2tzLCBubyBleHBsYW5hdGlvbiB0ZXh0LmA7XG5cbiAgICAgIGNvbnNvbGUubG9nKFwiPT09IEdlbmVyYXRpbmcgU3Rvcnlib29rIFN0cnVjdHVyZSA9PT1cIik7XG4gICAgICBjb25zdCBzdG9yeUNvbXBsZXRpb24gPSBhd2FpdCB0ZXh0TW9kZWwuZ2VuZXJhdGVDb250ZW50KHN0b3J5UHJvbXB0KTtcbiAgICAgIGxldCBzdG9yeVRleHQgPSBzdG9yeUNvbXBsZXRpb24ucmVzcG9uc2UudGV4dCgpO1xuICAgICAgXG4gICAgICAvLyBDbGVhbiB1cCBtYXJrZG93biBjb2RlIGJsb2Nrc1xuICAgICAgc3RvcnlUZXh0ID0gc3RvcnlUZXh0LnRyaW0oKTtcbiAgICAgIGlmIChzdG9yeVRleHQuc3RhcnRzV2l0aChcImBgYGpzb25cIikpIHtcbiAgICAgICAgc3RvcnlUZXh0ID0gc3RvcnlUZXh0LnJlcGxhY2UoL15gYGBqc29uXFxzKi8sIFwiXCIpLnJlcGxhY2UoL1xccypgYGAkLywgXCJcIik7XG4gICAgICB9IGVsc2UgaWYgKHN0b3J5VGV4dC5zdGFydHNXaXRoKFwiYGBgXCIpKSB7XG4gICAgICAgIHN0b3J5VGV4dCA9IHN0b3J5VGV4dC5yZXBsYWNlKC9eYGBgXFxzKi8sIFwiXCIpLnJlcGxhY2UoL1xccypgYGAkLywgXCJcIik7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGxldCBzdG9yeURhdGE6IGFueTtcbiAgICAgIHRyeSB7XG4gICAgICAgIHN0b3J5RGF0YSA9IEpTT04ucGFyc2Uoc3RvcnlUZXh0KTtcbiAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlN0b3J5IEpTT04gcGFyc2UgZXJyb3I6XCIsIHBhcnNlRXJyb3IpO1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJGYWlsZWQgdG8gcGFyc2Ugc3Rvcnkgc3RydWN0dXJlXCIgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFzdG9yeURhdGEucGFnZXMgfHwgc3RvcnlEYXRhLnBhZ2VzLmxlbmd0aCAhPT0gMTApIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiU3RvcnkgbXVzdCBoYXZlIGV4YWN0bHkgMTAgcGFnZXNcIiB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZyhgR2VuZXJhdGVkIHN0b3J5IHN0cnVjdHVyZTogJHtzdG9yeURhdGEudGl0bGV9IHdpdGggJHtzdG9yeURhdGEucGFnZXMubGVuZ3RofSBwYWdlc2ApO1xuXG4gICAgICAvLyBTdGVwIDI6IEdlbmVyYXRlIGltYWdlcyBmb3IgZWFjaCBwYWdlXG4gICAgICBjb25zdCBwYWdlc1dpdGhJbWFnZXMgPSBbXTtcbiAgICAgIGxldCBjb3ZlckltYWdlVXJsOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdG9yeURhdGEucGFnZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgcGFnZSA9IHN0b3J5RGF0YS5wYWdlc1tpXTtcbiAgICAgICAgY29uc29sZS5sb2coYEdlbmVyYXRpbmcgaW1hZ2UgZm9yIHBhZ2UgJHtwYWdlLnBhZ2VOdW1iZXJ9Li4uYCk7XG5cbiAgICAgICAgY29uc3QgaW1hZ2VQcm9tcHQgPSBgQ3JlYXRlIGEgcHJvZmVzc2lvbmFsLCB3aGltc2ljYWwgY2hpbGRyZW4ncyBib29rIGlsbHVzdHJhdGlvbi4gU3R5bGU6IGNvbG9yZnVsLCBwbGF5ZnVsLCBzdWl0YWJsZSBmb3IgYSA1LXllYXItb2xkLCBsaWtlIGEgaGlnaC1xdWFsaXR5IHBpY3R1cmUgYm9vayBieSBhdXRob3JzIGxpa2UgRXJpYyBDYXJsZSBvciBKdWxpYSBEb25hbGRzb24uIFxuXG4ke3BhZ2UuaW1hZ2VEZXNjcmlwdGlvbn1cblxuTWFrZSBpdCBicmlnaHQsIGVuZ2FnaW5nLCBhbmQgcHJvZmVzc2lvbmFsLiBUaGUgaWxsdXN0cmF0aW9uIHNob3VsZCBmaWxsIHRoZSBlbnRpcmUgaW1hZ2UgYW5kIGJlIHN1aXRhYmxlIGZvciBhIHN0b3J5Ym9vayBwYWdlLmA7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBpbWFnZUNvbXBsZXRpb24gPSBhd2FpdCBpbWFnZU1vZGVsLmdlbmVyYXRlQ29udGVudChpbWFnZVByb21wdCk7XG4gICAgICAgICAgY29uc3QgaW1hZ2VSZXNwb25zZSA9IGltYWdlQ29tcGxldGlvbi5yZXNwb25zZTtcbiAgICAgICAgICBcbiAgICAgICAgICBsZXQgYmFzZTY0SW1hZ2U6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEV4dHJhY3QgaW1hZ2UgZnJvbSByZXNwb25zZVxuICAgICAgICAgIGlmIChpbWFnZVJlc3BvbnNlLmNhbmRpZGF0ZXM/LlswXT8uY29udGVudD8ucGFydHMpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgcGFydCBvZiBpbWFnZVJlc3BvbnNlLmNhbmRpZGF0ZXNbMF0uY29udGVudC5wYXJ0cykge1xuICAgICAgICAgICAgICBpZiAocGFydC5pbmxpbmVEYXRhKSB7XG4gICAgICAgICAgICAgICAgYmFzZTY0SW1hZ2UgPSBwYXJ0LmlubGluZURhdGEuZGF0YTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChiYXNlNjRJbWFnZSkge1xuICAgICAgICAgICAgLy8gU2F2ZSB0byBTdXBhYmFzZSBTdG9yYWdlXG4gICAgICAgICAgICBjb25zdCBpbWFnZUJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGJhc2U2NEltYWdlLCBcImJhc2U2NFwiKTtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVOYW1lID0gYHN0b3J5Ym9va3MvJHtEYXRlLm5vdygpfS0ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZyg3KX0tcGFnZS0ke3BhZ2UucGFnZU51bWJlcn0ucG5nYDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgeyBkYXRhOiB1cGxvYWREYXRhLCBlcnJvcjogdXBsb2FkRXJyb3IgfSA9IGF3YWl0IGRiLnN0b3JhZ2VcbiAgICAgICAgICAgICAgLmZyb20oXCJjaGVja2xpc3RzXCIpIC8vIFVzaW5nIGNoZWNrbGlzdHMgYnVja2V0IGZvciBub3csIGNvdWxkIGNyZWF0ZSBhIHN0b3J5Ym9va3MgYnVja2V0XG4gICAgICAgICAgICAgIC51cGxvYWQoZmlsZU5hbWUsIGltYWdlQnVmZmVyLCB7XG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6IFwiaW1hZ2UvcG5nXCIsXG4gICAgICAgICAgICAgICAgdXBzZXJ0OiBmYWxzZSxcbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICghdXBsb2FkRXJyb3IgJiYgdXBsb2FkRGF0YSkge1xuICAgICAgICAgICAgICBjb25zdCB7IGRhdGE6IHVybERhdGEgfSA9IGRiLnN0b3JhZ2VcbiAgICAgICAgICAgICAgICAuZnJvbShcImNoZWNrbGlzdHNcIilcbiAgICAgICAgICAgICAgICAuZ2V0UHVibGljVXJsKGZpbGVOYW1lKTtcbiAgICAgICAgICAgICAgY29uc3QgaW1hZ2VVcmwgPSB1cmxEYXRhLnB1YmxpY1VybDtcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIHBhZ2VzV2l0aEltYWdlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBwYWdlTnVtYmVyOiBwYWdlLnBhZ2VOdW1iZXIsXG4gICAgICAgICAgICAgICAgdGV4dDogcGFnZS50ZXh0LFxuICAgICAgICAgICAgICAgIGltYWdlVXJsOiBpbWFnZVVybCxcbiAgICAgICAgICAgICAgICBpbWFnZURlc2NyaXB0aW9uOiBwYWdlLmltYWdlRGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgIC8vIFVzZSBmaXJzdCBwYWdlIGFzIGNvdmVyXG4gICAgICAgICAgICAgIGlmIChwYWdlLnBhZ2VOdW1iZXIgPT09IDEpIHtcbiAgICAgICAgICAgICAgICBjb3ZlckltYWdlVXJsID0gaW1hZ2VVcmw7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhg4pyTIFBhZ2UgJHtwYWdlLnBhZ2VOdW1iZXJ9IGltYWdlIHNhdmVkOiAke2ltYWdlVXJsfWApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgVXBsb2FkIGVycm9yIGZvciBwYWdlICR7cGFnZS5wYWdlTnVtYmVyfTpgLCB1cGxvYWRFcnJvcik7XG4gICAgICAgICAgICAgIC8vIENvbnRpbnVlIHdpdGhvdXQgaW1hZ2UgZm9yIHRoaXMgcGFnZVxuICAgICAgICAgICAgICBwYWdlc1dpdGhJbWFnZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgcGFnZU51bWJlcjogcGFnZS5wYWdlTnVtYmVyLFxuICAgICAgICAgICAgICAgIHRleHQ6IHBhZ2UudGV4dCxcbiAgICAgICAgICAgICAgICBpbWFnZVVybDogbnVsbCxcbiAgICAgICAgICAgICAgICBpbWFnZURlc2NyaXB0aW9uOiBwYWdlLmltYWdlRGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgTm8gaW1hZ2UgZGF0YSBmb3VuZCBmb3IgcGFnZSAke3BhZ2UucGFnZU51bWJlcn1gKTtcbiAgICAgICAgICAgIHBhZ2VzV2l0aEltYWdlcy5wdXNoKHtcbiAgICAgICAgICAgICAgcGFnZU51bWJlcjogcGFnZS5wYWdlTnVtYmVyLFxuICAgICAgICAgICAgICB0ZXh0OiBwYWdlLnRleHQsXG4gICAgICAgICAgICAgIGltYWdlVXJsOiBudWxsLFxuICAgICAgICAgICAgICBpbWFnZURlc2NyaXB0aW9uOiBwYWdlLmltYWdlRGVzY3JpcHRpb24sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGltYWdlRXJyb3I6IGFueSkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEltYWdlIGdlbmVyYXRpb24gZXJyb3IgZm9yIHBhZ2UgJHtwYWdlLnBhZ2VOdW1iZXJ9OmAsIGltYWdlRXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgLy8gQ29udGludWUgd2l0aG91dCBpbWFnZVxuICAgICAgICAgIHBhZ2VzV2l0aEltYWdlcy5wdXNoKHtcbiAgICAgICAgICAgIHBhZ2VOdW1iZXI6IHBhZ2UucGFnZU51bWJlcixcbiAgICAgICAgICAgIHRleHQ6IHBhZ2UudGV4dCxcbiAgICAgICAgICAgIGltYWdlVXJsOiBudWxsLFxuICAgICAgICAgICAgaW1hZ2VEZXNjcmlwdGlvbjogcGFnZS5pbWFnZURlc2NyaXB0aW9uLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQWRkIGEgc21hbGwgZGVsYXkgYmV0d2VlbiBpbWFnZSBnZW5lcmF0aW9ucyB0byBhdm9pZCByYXRlIGxpbWl0c1xuICAgICAgICBpZiAoaSA8IHN0b3J5RGF0YS5wYWdlcy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDUwMCkpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFN0ZXAgMzogU2F2ZSBzdG9yeWJvb2sgdG8gZGF0YWJhc2VcbiAgICAgIGNvbnN0IHN0b3J5Ym9va0RhdGEgPSB7XG4gICAgICAgIHRpdGxlOiBzdG9yeURhdGEudGl0bGUsXG4gICAgICAgIHBhZ2VzOiBwYWdlc1dpdGhJbWFnZXMsXG4gICAgICAgIG9yaWdpbmFsUHJvbXB0OiBiYXNlUHJvbXB0LFxuICAgICAgfTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgeyBkYXRhOiBpbnNlcnRlZCwgZXJyb3IgfSA9IGF3YWl0IGRiXG4gICAgICAgICAgLmZyb20oXCJjb250ZW50X2l0ZW1zXCIpXG4gICAgICAgICAgLmluc2VydCh7XG4gICAgICAgICAgICBwcm9maWxlX2lkOiBudWxsLFxuICAgICAgICAgICAgY2hpbGRfaWQ6IG51bGwsXG4gICAgICAgICAgICB0aXRsZTogc3Rvcnlib29rRGF0YS50aXRsZSxcbiAgICAgICAgICAgIGNhdGVnb3J5OiBib2R5LmNhdGVnb3J5LFxuICAgICAgICAgICAgdHlwZTogXCJzdG9yeVwiLCAvLyBVc2luZyBcInN0b3J5XCIgdHlwZSBzaW5jZSBcInN0b3J5Ym9va1wiIGlzbid0IGluIHRoZSBlbnVtIHlldFxuICAgICAgICAgICAgYm9keTogc3Rvcnlib29rRGF0YSxcbiAgICAgICAgICAgIGNvdmVyX3VybDogY292ZXJJbWFnZVVybCxcbiAgICAgICAgICAgIGlzX3B1YmxpYzogdHJ1ZSxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRGF0YWJhc2UgaW5zZXJ0IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnNvbGUubG9nKFwiPT09IFN0b3J5Ym9vayBHZW5lcmF0ZWQgU3VjY2Vzc2Z1bGx5ID09PVwiKTtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgY29udGVudDogaW5zZXJ0ZWQgfSk7XG4gICAgICB9IGNhdGNoIChkYkVycm9yOiBhbnkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkRhdGFiYXNlIGVycm9yOlwiLCBkYkVycm9yKTtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IGRiRXJyb3IubWVzc2FnZSB8fCBcIkRhdGFiYXNlIGVycm9yXCIgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBGb3Igb3RoZXIgdHlwZXMsIHVzZSB0ZXh0IGdlbmVyYXRpb24gd2l0aCBHZW1pbmlcbiAgICBjb25zdCBnZW5BSSA9IGdldEdlbWluaSgpO1xuICAgIGNvbnN0IG1vZGVsID0gZ2VuQUkuZ2V0R2VuZXJhdGl2ZU1vZGVsKHsgbW9kZWw6IFwiZ2VtaW5pLTIuNS1mbGFzaFwiIH0pO1xuXG4gICAgbGV0IGZ1bGxQcm9tcHQgPSBcIllvdSBhcmUgYSBoZWxwZXIgZm9yIHBhcmVudHMgb2YgeW91bmcgY2hpbGRyZW4uXFxuXFxuXCI7XG4gICAgY29uc3QgYmFzZVByb21wdCA9IGJvZHkucHJvbXB0ID8/IFwiQ3JlYXRlIGEgc3VwcG9ydGl2ZSwgYWdlLWFwcHJvcHJpYXRlIHBpZWNlIGZvciBhIHByZXNjaG9vbGVyLlwiO1xuICAgIFxuICAgIGlmIChib2R5LnR5cGUgPT09IFwic3RvcnlcIikge1xuICAgICAgZnVsbFByb21wdCArPSBgJHtiYXNlUHJvbXB0fVxcblxcbkNyZWF0ZSBhIHN1cHBvcnRpdmUgcGVyc29uYWxpemVkIHN0b3J5IGZvciBhIGNoaWxkIGFib3V0IHRoaXMgc2l0dWF0aW9uLiBSZXR1cm4gT05MWSB2YWxpZCBKU09OIGluIHRoaXMgZXhhY3QgZm9ybWF0OiB7XCJ0aXRsZVwiOiBcIlN0b3J5IFRpdGxlXCIsIFwib3V0bGluZVwiOiBbXCJwb2ludCAxXCIsIFwicG9pbnQgMlwiXSwgXCJzdG9yeV9odG1sXCI6IFwiPHA+RnVsbCBzdG9yeSBIVE1MIGhlcmU8L3A+XCJ9YDtcbiAgICB9IGVsc2UgaWYgKGJvZHkudHlwZSA9PT0gXCJzb25nX2x5cmljc1wiKSB7XG4gICAgICBmdWxsUHJvbXB0ICs9IGAke2Jhc2VQcm9tcHR9XFxuXFxuQ3JlYXRlIHBsYXlmdWwgYmVkdGltZSBzb25nIGx5cmljcyBvbmx5LiBSZXR1cm4gT05MWSB2YWxpZCBKU09OOiB7XCJ0aXRsZVwiOiBcIlNvbmcgVGl0bGVcIiwgXCJseXJpY3NcIjogXCJGdWxsIGx5cmljcyB0ZXh0XCIsIFwic3R5bGVcIjogXCJsdWxsYWJ5XCJ9YDtcbiAgICB9IGVsc2UgaWYgKGJvZHkudHlwZSA9PT0gXCJzY2hlZHVsZVwiIHx8IGJvZHkudHlwZSA9PT0gXCJjYWxlbmRhclwiKSB7XG4gICAgICBmdWxsUHJvbXB0ICs9IGAke2Jhc2VQcm9tcHR9XFxuXFxuQ3JlYXRlIGEgc2ltcGxlIHNjaGVkdWxlLiBSZXR1cm4gT05MWSB2YWxpZCBKU09OOiB7XCJ0aXRsZVwiOiBcIlNjaGVkdWxlIFRpdGxlXCIsIFwiaXRlbXNcIjogW3tcInRpbWVcIjogXCI5OjAwIEFNXCIsIFwibGFiZWxcIjogXCJBY3Rpdml0eVwifV19YDtcbiAgICB9XG5cbiAgICBmdWxsUHJvbXB0ICs9IFwiXFxuXFxuSW1wb3J0YW50OiBSZXR1cm4gT05MWSB0aGUgSlNPTiBvYmplY3QsIG5vIG1hcmtkb3duIGNvZGUgYmxvY2tzLCBubyBleHBsYW5hdGlvbiB0ZXh0LlwiO1xuXG4gICAgY29uc3QgY29tcGxldGlvbiA9IGF3YWl0IG1vZGVsLmdlbmVyYXRlQ29udGVudChmdWxsUHJvbXB0KTtcbiAgICBsZXQgdGV4dCA9IGNvbXBsZXRpb24ucmVzcG9uc2UudGV4dCgpO1xuICAgIFxuICAgIC8vIENsZWFuIHVwIG1hcmtkb3duIGNvZGUgYmxvY2tzIGlmIHByZXNlbnRcbiAgICB0ZXh0ID0gdGV4dC50cmltKCk7XG4gICAgaWYgKHRleHQuc3RhcnRzV2l0aChcImBgYGpzb25cIikpIHtcbiAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL15gYGBqc29uXFxzKi8sIFwiXCIpLnJlcGxhY2UoL1xccypgYGAkLywgXCJcIik7XG4gICAgfSBlbHNlIGlmICh0ZXh0LnN0YXJ0c1dpdGgoXCJgYGBcIikpIHtcbiAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL15gYGBcXHMqLywgXCJcIikucmVwbGFjZSgvXFxzKmBgYCQvLCBcIlwiKTtcbiAgICB9XG4gICAgXG4gICAgbGV0IHBhcnNlZDogYW55O1xuICAgIHRyeSB7XG4gICAgICBwYXJzZWQgPSBKU09OLnBhcnNlKHRleHQpO1xuICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJKU09OIHBhcnNlIGVycm9yOlwiLCBwYXJzZUVycm9yLCBcIlRleHQgd2FzOlwiLCB0ZXh0LnN1YnN0cmluZygwLCAyMDApKTtcbiAgICAgIC8vIEZhbGxiYWNrOiBjcmVhdGUgYSBzaW1wbGUgc3RydWN0dXJlXG4gICAgICBwYXJzZWQgPSB7XG4gICAgICAgIHRpdGxlOiBcIkdlbmVyYXRlZCBTdG9yeVwiLFxuICAgICAgICBvdXRsaW5lOiBbXCJJbnRyb2R1Y3Rpb25cIiwgXCJNYWluIHN0b3J5XCIsIFwiQ29uY2x1c2lvblwiXSxcbiAgICAgICAgc3RvcnlfaHRtbDogYDxwPiR7dGV4dC5yZXBsYWNlKC9cXG4vZywgXCI8L3A+PHA+XCIpfTwvcD5gLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCB7IGRhdGE6IGluc2VydGVkLCBlcnJvciB9ID0gYXdhaXQgZGJcbiAgICAgIC5mcm9tKFwiY29udGVudF9pdGVtc1wiKVxuICAgICAgLmluc2VydCh7XG4gICAgICAgIHByb2ZpbGVfaWQ6IG51bGwsXG4gICAgICAgIGNoaWxkX2lkOiBudWxsLFxuICAgICAgICB0aXRsZTogcGFyc2VkLnRpdGxlID8/IFwiR2VuZXJhdGVkXCIsXG4gICAgICAgIGNhdGVnb3J5OiBib2R5LmNhdGVnb3J5LFxuICAgICAgICB0eXBlOiBib2R5LnR5cGUsXG4gICAgICAgIGJvZHk6IHBhcnNlZCxcbiAgICAgICAgaXNfcHVibGljOiB0cnVlLFxuICAgICAgfSlcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKGVycm9yKSByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGNvbnRlbnQ6IGluc2VydGVkIH0pO1xuICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiR2VuZXJhdGUgZXJyb3I6XCIsIGUpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBlLm1lc3NhZ2UgfHwgXCJHZW5lcmF0aW9uIGZhaWxlZFwiIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gIH1cbn1cblxuXG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiZ2V0U2VydmljZUNsaWVudCIsImdldEdlbWluaSIsIlBPU1QiLCJyZXEiLCJwcm9jZXNzIiwiZW52IiwiR0VNSU5JX0FQSV9LRVkiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiYm9keSIsImRiIiwidHlwZSIsImZhdm9yaXRlVGhpbmciLCJyb3V0aW5lSXRlbXMiLCJsZW5ndGgiLCJmaWx0ZXIiLCJpdGVtIiwidHJpbSIsImNoZWNrbGlzdE5hbWUiLCJpbWFnZXJ5RGVzY3JpcHRpb25zIiwibWFwIiwiaW5kZXgiLCJpdGVtTnVtIiwiaXNGaXJzdCIsImlzTGFzdCIsImRlc2NyaXB0aW9uIiwidG9Mb3dlckNhc2UiLCJpbmNsdWRlcyIsImpvaW4iLCJpbWFnZVByb21wdCIsImNvbnNvbGUiLCJsb2ciLCJpbWFnZVVybCIsImdlbkFJIiwibW9kZWwiLCJnZXRHZW5lcmF0aXZlTW9kZWwiLCJjb21wbGV0aW9uIiwiZ2VuZXJhdGVDb250ZW50IiwicmVzcG9uc2UiLCJjYW5kaWRhdGVzIiwiYmFzZTY0SW1hZ2UiLCJjb250ZW50IiwicGFydHMiLCJwYXJ0IiwiT2JqZWN0Iiwia2V5cyIsImlubGluZURhdGEiLCJkYXRhIiwibWltZVR5cGUiLCJ0ZXh0Iiwic3Vic3RyaW5nIiwiaW1hZ2VCdWZmZXIiLCJCdWZmZXIiLCJmcm9tIiwiZmlsZU5hbWUiLCJEYXRlIiwibm93IiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwidXBsb2FkRGF0YSIsInVwbG9hZEVycm9yIiwic3RvcmFnZSIsInVwbG9hZCIsImNvbnRlbnRUeXBlIiwidXBzZXJ0IiwidXJsRGF0YSIsImdldFB1YmxpY1VybCIsInB1YmxpY1VybCIsInN0b3JhZ2VFcnJvciIsImltYWdlRXJyb3IiLCJtZXNzYWdlIiwic3RlcHMiLCJsYWJlbCIsInRpcCIsInBhcnNlZCIsInRpdGxlIiwiaW1hZ2VfdXJsIiwiaW1hZ2VfcHJvbXB0IiwiaW5zZXJ0ZWQiLCJpbnNlcnQiLCJwcm9maWxlX2lkIiwiY2hpbGRfaWQiLCJjYXRlZ29yeSIsImNvdmVyX3VybCIsImlzX3B1YmxpYyIsInNlbGVjdCIsInNpbmdsZSIsImRiRXJyb3IiLCJ0ZXh0TW9kZWwiLCJpbWFnZU1vZGVsIiwiYmFzZVByb21wdCIsInByb21wdCIsInN0b3J5UHJvbXB0Iiwic3RvcnlDb21wbGV0aW9uIiwic3RvcnlUZXh0Iiwic3RhcnRzV2l0aCIsInJlcGxhY2UiLCJzdG9yeURhdGEiLCJKU09OIiwicGFyc2UiLCJwYXJzZUVycm9yIiwicGFnZXMiLCJwYWdlc1dpdGhJbWFnZXMiLCJjb3ZlckltYWdlVXJsIiwiaSIsInBhZ2UiLCJwYWdlTnVtYmVyIiwiaW1hZ2VEZXNjcmlwdGlvbiIsImltYWdlQ29tcGxldGlvbiIsImltYWdlUmVzcG9uc2UiLCJwdXNoIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0Iiwic3Rvcnlib29rRGF0YSIsIm9yaWdpbmFsUHJvbXB0IiwiZnVsbFByb21wdCIsIm91dGxpbmUiLCJzdG9yeV9odG1sIiwiZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/content/generate/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/gemini.ts":
/*!***********************!*\
  !*** ./lib/gemini.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getGemini: () => (/* binding */ getGemini)\n/* harmony export */ });\n/* harmony import */ var _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @google/generative-ai */ \"(rsc)/./node_modules/@google/generative-ai/dist/index.mjs\");\n\nconst apiKey = process.env.GEMINI_API_KEY;\nfunction getGemini() {\n    return new _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.GoogleGenerativeAI(apiKey);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvZ2VtaW5pLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQTJEO0FBRTNELE1BQU1DLFNBQVNDLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYztBQUVsQyxTQUFTQztJQUNkLE9BQU8sSUFBSUwscUVBQWtCQSxDQUFDQztBQUNoQyIsInNvdXJjZXMiOlsid2VicGFjazovL2thcmFza2lkZG9zLy4vbGliL2dlbWluaS50cz9iNjM1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEdvb2dsZUdlbmVyYXRpdmVBSSB9IGZyb20gXCJAZ29vZ2xlL2dlbmVyYXRpdmUtYWlcIjtcblxuY29uc3QgYXBpS2V5ID0gcHJvY2Vzcy5lbnYuR0VNSU5JX0FQSV9LRVkhO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0R2VtaW5pKCkge1xuICByZXR1cm4gbmV3IEdvb2dsZUdlbmVyYXRpdmVBSShhcGlLZXkpO1xufVxuXG5cbiJdLCJuYW1lcyI6WyJHb29nbGVHZW5lcmF0aXZlQUkiLCJhcGlLZXkiLCJwcm9jZXNzIiwiZW52IiwiR0VNSU5JX0FQSV9LRVkiLCJnZXRHZW1pbmkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/gemini.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase/server.ts":
/*!********************************!*\
  !*** ./lib/supabase/server.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getServiceClient: () => (/* binding */ getServiceClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\nfunction getServiceClient() {\n    const url = \"https://treseoebwfddtbapyfus.supabase.co\";\n    const serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n    if (!url) {\n        throw new Error(\"NEXT_PUBLIC_SUPABASE_URL is not set\");\n    }\n    if (!serviceKey) {\n        throw new Error(\"SUPABASE_SERVICE_ROLE_KEY is not set\");\n    }\n    // Validate that the service key looks like a JWT (starts with eyJ)\n    if (!serviceKey.startsWith(\"eyJ\")) {\n        throw new Error(\"SUPABASE_SERVICE_ROLE_KEY appears to be invalid (should be a JWT token starting with 'eyJ')\");\n    }\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(url, serviceKey, {\n        auth: {\n            persistSession: false\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2Uvc2VydmVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQXFEO0FBRTlDLFNBQVNDO0lBQ2QsTUFBTUMsTUFBTUMsMENBQW9DO0lBQ2hELE1BQU1HLGFBQWFILFFBQVFDLEdBQUcsQ0FBQ0cseUJBQXlCO0lBRXhELElBQUksQ0FBQ0wsS0FBSztRQUNSLE1BQU0sSUFBSU0sTUFBTTtJQUNsQjtJQUVBLElBQUksQ0FBQ0YsWUFBWTtRQUNmLE1BQU0sSUFBSUUsTUFBTTtJQUNsQjtJQUVBLG1FQUFtRTtJQUNuRSxJQUFJLENBQUNGLFdBQVdHLFVBQVUsQ0FBQyxRQUFRO1FBQ2pDLE1BQU0sSUFBSUQsTUFBTTtJQUNsQjtJQUVBLE9BQU9SLG1FQUFZQSxDQUFDRSxLQUFLSSxZQUFZO1FBQUVJLE1BQU07WUFBRUMsZ0JBQWdCO1FBQU07SUFBRTtBQUN6RSIsInNvdXJjZXMiOlsid2VicGFjazovL2thcmFza2lkZG9zLy4vbGliL3N1cGFiYXNlL3NlcnZlci50cz82NjI1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAc3VwYWJhc2Uvc3VwYWJhc2UtanNcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldFNlcnZpY2VDbGllbnQoKSB7XG4gIGNvbnN0IHVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcbiAgY29uc3Qgc2VydmljZUtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVk7XG4gIFxuICBpZiAoIXVybCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCBpcyBub3Qgc2V0XCIpO1xuICB9XG4gIFxuICBpZiAoIXNlcnZpY2VLZXkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIGlzIG5vdCBzZXRcIik7XG4gIH1cbiAgXG4gIC8vIFZhbGlkYXRlIHRoYXQgdGhlIHNlcnZpY2Uga2V5IGxvb2tzIGxpa2UgYSBKV1QgKHN0YXJ0cyB3aXRoIGV5SilcbiAgaWYgKCFzZXJ2aWNlS2V5LnN0YXJ0c1dpdGgoXCJleUpcIikpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIGFwcGVhcnMgdG8gYmUgaW52YWxpZCAoc2hvdWxkIGJlIGEgSldUIHRva2VuIHN0YXJ0aW5nIHdpdGggJ2V5SicpXCIpO1xuICB9XG4gIFxuICByZXR1cm4gY3JlYXRlQ2xpZW50KHVybCwgc2VydmljZUtleSwgeyBhdXRoOiB7IHBlcnNpc3RTZXNzaW9uOiBmYWxzZSB9IH0pO1xufVxuXG5cbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJnZXRTZXJ2aWNlQ2xpZW50IiwidXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInNlcnZpY2VLZXkiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiRXJyb3IiLCJzdGFydHNXaXRoIiwiYXV0aCIsInBlcnNpc3RTZXNzaW9uIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase/server.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@opentelemetry","vendor-chunks/@supabase","vendor-chunks/whatwg-url","vendor-chunks/tr46","vendor-chunks/@google","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcontent%2Fgenerate%2Froute&page=%2Fapi%2Fcontent%2Fgenerate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcontent%2Fgenerate%2Froute.ts&appDir=%2FUsers%2Fkarayu%2Fprojects%2Fkaraskiddos%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkarayu%2Fprojects%2Fkaraskiddos&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();