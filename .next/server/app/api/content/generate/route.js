"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/content/generate/route";
exports.ids = ["app/api/content/generate/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcontent%2Fgenerate%2Froute&page=%2Fapi%2Fcontent%2Fgenerate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcontent%2Fgenerate%2Froute.ts&appDir=%2FUsers%2Fkarayu%2Fprojects%2Fkaraskiddos%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkarayu%2Fprojects%2Fkaraskiddos&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcontent%2Fgenerate%2Froute&page=%2Fapi%2Fcontent%2Fgenerate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcontent%2Fgenerate%2Froute.ts&appDir=%2FUsers%2Fkarayu%2Fprojects%2Fkaraskiddos%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkarayu%2Fprojects%2Fkaraskiddos&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_karayu_projects_karaskiddos_app_api_content_generate_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/content/generate/route.ts */ \"(rsc)/./app/api/content/generate/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/content/generate/route\",\n        pathname: \"/api/content/generate\",\n        filename: \"route\",\n        bundlePath: \"app/api/content/generate/route\"\n    },\n    resolvedPagePath: \"/Users/karayu/projects/karaskiddos/app/api/content/generate/route.ts\",\n    nextConfigOutput,\n    userland: _Users_karayu_projects_karaskiddos_app_api_content_generate_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/content/generate/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZjb250ZW50JTJGZ2VuZXJhdGUlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmNvbnRlbnQlMkZnZW5lcmF0ZSUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmNvbnRlbnQlMkZnZW5lcmF0ZSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmthcmF5dSUyRnByb2plY3RzJTJGa2FyYXNraWRkb3MlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGa2FyYXl1JTJGcHJvamVjdHMlMkZrYXJhc2tpZGRvcyZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDb0I7QUFDakc7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9rYXJhc2tpZGRvcy8/Zjg1ZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMva2FyYXl1L3Byb2plY3RzL2thcmFza2lkZG9zL2FwcC9hcGkvY29udGVudC9nZW5lcmF0ZS9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvY29udGVudC9nZW5lcmF0ZS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2NvbnRlbnQvZ2VuZXJhdGVcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2NvbnRlbnQvZ2VuZXJhdGUvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMva2FyYXl1L3Byb2plY3RzL2thcmFza2lkZG9zL2FwcC9hcGkvY29udGVudC9nZW5lcmF0ZS9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvY29udGVudC9nZW5lcmF0ZS9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcontent%2Fgenerate%2Froute&page=%2Fapi%2Fcontent%2Fgenerate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcontent%2Fgenerate%2Froute.ts&appDir=%2FUsers%2Fkarayu%2Fprojects%2Fkaraskiddos%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkarayu%2Fprojects%2Fkaraskiddos&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/content/generate/route.ts":
/*!*******************************************!*\
  !*** ./app/api/content/generate/route.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_supabase_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/supabase/server */ \"(rsc)/./lib/supabase/server.ts\");\n/* harmony import */ var _lib_gemini__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/gemini */ \"(rsc)/./lib/gemini.ts\");\n\n\n\nasync function POST(req) {\n    try {\n        if (!process.env.GEMINI_API_KEY) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"GEMINI_API_KEY not configured\"\n            }, {\n                status: 500\n            });\n        }\n        if ( false || !process.env.SUPABASE_SERVICE_ROLE_KEY) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Supabase not configured\"\n            }, {\n                status: 500\n            });\n        }\n        const body = await req.json();\n        const db = (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_1__.getServiceClient)();\n        // For checklist type, generate an image using Gemini 2.5 Flash\n        if (body.type === \"checklist\") {\n            // Get favorite thing and routine items from form data\n            const favoriteThing = body.favoriteThing || \"unicorn\";\n            const routineItems = body.routineItems && body.routineItems.length > 0 ? body.routineItems.filter((item)=>item.trim() !== \"\") : [\n                \"brush teeth\",\n                \"put on pajamas\",\n                \"read book\"\n            ];\n            // Build the checklist name\n            const checklistName = `Rhea the ${favoriteThing} goes to bed`;\n            // Build the imagery descriptions for each routine item with colorful descriptions\n            const imageryDescriptions = routineItems.map((item, index)=>{\n                const itemNum = index + 1;\n                const isFirst = index === 0;\n                const isLast = index === routineItems.length - 1;\n                // Add colorful descriptions based on position\n                let description = \"\";\n                if (isFirst) {\n                    description = `with a proud smile on their face. Use bright colorful colors.`;\n                } else if (isLast) {\n                    // Special handling for reading/book items\n                    if (item.toLowerCase().includes(\"read\") || item.toLowerCase().includes(\"book\")) {\n                        description = `in bed with their eyes closed, looking peaceful and sleepy.`;\n                    } else {\n                        description = `with a happy, content expression.`;\n                    }\n                } else if (index === 1) {\n                    description = `but struggling with it, looking determined.`;\n                } else {\n                    description = `with focused concentration.`;\n                }\n                return `${itemNum}) On the ${isFirst ? \"first\" : isLast && routineItems.length > 2 ? \"last\" : itemNum === 2 ? \"second\" : `${itemNum}th`} row, it should show the ${favoriteThing} ${item} ${description}`;\n            }).join(\"\\n\\n\");\n            const imagePrompt = `Create an illustrated checklist. This checklist should have a whimsical theme, appropriate for looking fun/exciting to a 5 year old. Make the protagonist a ${favoriteThing}, excited to do each of the steps. Make it look professionally illustrated by a children's book author like Hollie Mengert.\n\nThe name of the checklist should be: ${checklistName}\n\nOn the left column, the checklist should have imagery:\n\n${imageryDescriptions}\n\nMake the ${favoriteThing} images take up half the page.\n\nOn the right column, it should just feature ${routineItems.length} blank rows (so that the child can write in them)\n\nMake it good!`;\n            console.log(\"Image Prompt:\", imagePrompt);\n            console.log(\"======================\");\n            // Use Gemini 2.5 Flash Image for image generation\n            // Reference: https://ai.google.dev/gemini-api/docs/image-generation#javascript\n            let imageUrl = null;\n            try {\n                const genAI = (0,_lib_gemini__WEBPACK_IMPORTED_MODULE_2__.getGemini)();\n                // Use the correct model name for image generation\n                const model = genAI.getGenerativeModel({\n                    model: \"gemini-2.5-flash-image\"\n                });\n                console.log(\"=== Calling Gemini for Image Generation ===\");\n                console.log(\"Model: gemini-2.5-flash-image\");\n                console.log(\"Image Prompt:\", imagePrompt);\n                // Generate image using Gemini 2.5 Flash Image\n                const completion = await model.generateContent(imagePrompt);\n                const response = completion.response;\n                console.log(\"=== Gemini Response ===\");\n                console.log(\"Candidates:\", response.candidates?.length);\n                // Check for image data in the response parts\n                let base64Image = null;\n                // Iterate through all parts in the response\n                if (response.candidates?.[0]?.content?.parts) {\n                    for (const part of response.candidates[0].content.parts){\n                        console.log(\"Part keys:\", Object.keys(part));\n                        // Check for inlineData (image data)\n                        if (part.inlineData) {\n                            base64Image = part.inlineData.data;\n                            console.log(\"Found image in inlineData, mimeType:\", part.inlineData.mimeType);\n                            break; // Found the image, no need to check other parts\n                        }\n                        // Check for text (might contain image description or URL)\n                        if (part.text) {\n                            console.log(\"Part text preview:\", part.text.substring(0, 200));\n                        }\n                    }\n                }\n                console.log(\"Base64 image found:\", base64Image ? \"Yes\" : \"No\");\n                console.log(\"======================\");\n                // If we have a base64 image, save it to Supabase Storage\n                if (base64Image) {\n                    try {\n                        const imageBuffer = Buffer.from(base64Image, \"base64\");\n                        const fileName = `checklists/${Date.now()}-${Math.random().toString(36).substring(7)}.png`;\n                        const { data: uploadData, error: uploadError } = await db.storage.from(\"checklists\").upload(fileName, imageBuffer, {\n                            contentType: \"image/png\",\n                            upsert: false\n                        });\n                        if (!uploadError && uploadData) {\n                            const { data: urlData } = db.storage.from(\"checklists\").getPublicUrl(fileName);\n                            imageUrl = urlData.publicUrl;\n                            console.log(\"Image saved to Supabase Storage:\", imageUrl);\n                            console.log(\"\\uD83D\\uDD17 Direct link to generated image:\", imageUrl);\n                        } else {\n                            console.error(\"Storage upload error:\", uploadError);\n                            // Fallback to data URL if storage fails\n                            imageUrl = `data:image/png;base64,${base64Image}`;\n                        }\n                    } catch (storageError) {\n                        console.error(\"Storage error:\", storageError);\n                        imageUrl = `data:image/png;base64,${base64Image}`;\n                    }\n                } else {\n                    console.log(\"No image data found in Gemini response\");\n                }\n            } catch (imageError) {\n                console.error(\"Image generation error:\", imageError.message || imageError);\n            // Continue without image - we'll still create the checklist\n            }\n            // Build steps from the same routineItems we used for the image prompt\n            const steps = routineItems.map((item)=>({\n                    label: item.trim(),\n                    tip: `Great job on ${item.trim()}!`\n                }));\n            const parsed = {\n                title: checklistName,\n                steps,\n                image_url: imageUrl,\n                image_prompt: imagePrompt\n            };\n            try {\n                const { data: inserted, error } = await db.from(\"content_items\").insert({\n                    profile_id: null,\n                    child_id: null,\n                    title: parsed.title,\n                    category: body.category,\n                    type: body.type,\n                    body: parsed,\n                    cover_url: imageUrl,\n                    is_public: true\n                }).select().single();\n                if (error) {\n                    console.error(\"Database insert error:\", error);\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: error.message\n                    }, {\n                        status: 500\n                    });\n                }\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    content: inserted\n                });\n            } catch (dbError) {\n                console.error(\"Database error:\", dbError);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: dbError.message || \"Database error\"\n                }, {\n                    status: 500\n                });\n            }\n        }\n        // For storybook type, generate a 10-page illustrated storybook\n        if (body.type === \"storybook\") {\n            try {\n                const genAI = (0,_lib_gemini__WEBPACK_IMPORTED_MODULE_2__.getGemini)();\n                const textModel = genAI.getGenerativeModel({\n                    model: \"gemini-2.5-flash\"\n                });\n                const imageModel = genAI.getGenerativeModel({\n                    model: \"gemini-2.5-flash-image\"\n                });\n                const basePrompt = body.prompt || \"Create a fun, entertaining story for a 5-year-old with a conflict that gets resolved at the end.\";\n                // Step 1: Generate the story structure (10 pages)\n                const storyPrompt = `${basePrompt}\n\nCreate a professional, whimsical 10-page storybook for a 5-year-old child. The story should:\n- Have a clear conflict that gets resolved by the end\n- Be entertaining and age-appropriate\n- Be professional and whimsical in style, like the illustrations by Hollie Mengert or Daniel Salmieri\n- Each page should have 2-3 sentences of text\n\nIMPORTANT FOR ILLUSTRATIONS:\n- All illustrations must use the SAME drawing style across all 10 pages\n- The protagonist must look EXACTLY the same in every illustration (same appearance, clothing, colors, physical features)\n- The artistic style should be professional and whimsical, consistent throughout the entire storybook\n\nReturn ONLY valid JSON in this exact format:\n{\n  \"title\": \"Story Title\",\n  \"protagonistDescription\": \"Detailed description of the protagonist's appearance, including physical features, clothing, colors, and any distinctive characteristics. This description will be used to ensure the protagonist looks identical across all 10 pages.\",\n  \"pages\": [\n    {\"pageNumber\": 1, \"text\": \"Page 1 text here\", \"imageDescription\": \"Detailed description of what should be illustrated on this page\"},\n    {\"pageNumber\": 2, \"text\": \"Page 2 text here\", \"imageDescription\": \"Detailed description...\"},\n    ... (10 pages total)\n  ]\n}\n\nImportant: Return ONLY the JSON object, no markdown code blocks, no explanation text.`;\n                console.log(\"=== Generating Storybook Structure ===\");\n                const storyCompletion = await textModel.generateContent(storyPrompt);\n                let storyText = storyCompletion.response.text();\n                // Clean up markdown code blocks\n                storyText = storyText.trim();\n                if (storyText.startsWith(\"```json\")) {\n                    storyText = storyText.replace(/^```json\\s*/, \"\").replace(/\\s*```$/, \"\");\n                } else if (storyText.startsWith(\"```\")) {\n                    storyText = storyText.replace(/^```\\s*/, \"\").replace(/\\s*```$/, \"\");\n                }\n                let storyData;\n                try {\n                    storyData = JSON.parse(storyText);\n                    console.log(\"Parsed story data:\", JSON.stringify(storyData, null, 2).substring(0, 500));\n                } catch (parseError) {\n                    console.error(\"Story JSON parse error:\", parseError);\n                    console.error(\"Raw story text:\", storyText.substring(0, 500));\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: \"Failed to parse story structure\",\n                        details: parseError.message,\n                        rawText: storyText.substring(0, 200)\n                    }, {\n                        status: 500\n                    });\n                }\n                if (!storyData.pages || !Array.isArray(storyData.pages)) {\n                    console.error(\"Invalid pages data:\", storyData);\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: \"Story structure missing pages array\",\n                        received: Object.keys(storyData)\n                    }, {\n                        status: 500\n                    });\n                }\n                if (storyData.pages.length !== 10) {\n                    console.error(`Expected 10 pages, got ${storyData.pages.length}`);\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: `Story must have exactly 10 pages, got ${storyData.pages.length}`\n                    }, {\n                        status: 500\n                    });\n                }\n                console.log(`Generated story structure: ${storyData.title} with ${storyData.pages.length} pages`);\n                console.log(`Protagonist description: ${storyData.protagonistDescription ? \"Present\" : \"Missing (optional)\"}`);\n                // Step 2: Generate images for each page\n                const pagesWithImages = [];\n                let coverImageUrl = null;\n                let firstAvailableImageUrl = null;\n                for(let i = 0; i < storyData.pages.length; i++){\n                    const page = storyData.pages[i];\n                    console.log(`Generating image for page ${page.pageNumber}...`);\n                    // Get protagonist description from story data for consistency\n                    const protagonistDesc = storyData.protagonistDescription || \"\";\n                    // Build style consistency instructions\n                    let styleConsistencyNote = \"\";\n                    if (i === 0) {\n                        styleConsistencyNote = \"This is the first page - establish the artistic style that will be used consistently across all 10 pages.\";\n                    } else {\n                        styleConsistencyNote = \"CRITICAL: Use the EXACT same artistic style, color palette, and illustration technique as page 1. The drawing style must be identical to maintain visual consistency throughout the storybook.\";\n                    }\n                    const imagePrompt = `Create a professional, whimsical children's book illustration in the style of Hollie Mengert or Daniel Salmieri. The illustration should be:\n- Professional and whimsical, with a cohesive artistic style\n- Colorful, playful, and suitable for a 5-year-old\n- High-quality, like a published picture book\n\n${styleConsistencyNote}\n\n${protagonistDesc ? `CRITICAL: The protagonist must look exactly like this in every illustration: ${protagonistDesc}. Make sure the protagonist's appearance (physical features, clothing, colors, etc.) is identical across all pages.` : \"\"}\n\n${page.imageDescription}\n\n${protagonistDesc ? `Remember: The protagonist must match the description provided above exactly.` : \"\"}\n\nMake it bright, engaging, and professional. The illustration should fill the entire image and be suitable for a storybook page. Ensure the artistic style is consistent with the other pages in this storybook.`;\n                    try {\n                        const imageCompletion = await imageModel.generateContent(imagePrompt);\n                        const imageResponse = imageCompletion.response;\n                        let base64Image = null;\n                        // Extract image from response\n                        if (imageResponse.candidates?.[0]?.content?.parts) {\n                            for (const part of imageResponse.candidates[0].content.parts){\n                                if (part.inlineData) {\n                                    base64Image = part.inlineData.data;\n                                    break;\n                                }\n                            }\n                        }\n                        if (base64Image) {\n                            // Save to Supabase Storage\n                            const imageBuffer = Buffer.from(base64Image, \"base64\");\n                            const fileName = `storybooks/${Date.now()}-${Math.random().toString(36).substring(7)}-page-${page.pageNumber}.png`;\n                            const { data: uploadData, error: uploadError } = await db.storage.from(\"checklists\") // Using checklists bucket for now, could create a storybooks bucket\n                            .upload(fileName, imageBuffer, {\n                                contentType: \"image/png\",\n                                upsert: false\n                            });\n                            if (!uploadError && uploadData) {\n                                const { data: urlData } = db.storage.from(\"checklists\").getPublicUrl(fileName);\n                                const imageUrl = urlData.publicUrl;\n                                pagesWithImages.push({\n                                    pageNumber: page.pageNumber,\n                                    text: page.text,\n                                    imageUrl: imageUrl,\n                                    imageDescription: page.imageDescription\n                                });\n                                // Use first page as cover/thumbnail\n                                if (page.pageNumber === 1) {\n                                    coverImageUrl = imageUrl;\n                                    console.log(`✓ Cover/thumbnail set from page 1: ${imageUrl}`);\n                                }\n                                // Track first available image as fallback\n                                if (!firstAvailableImageUrl) {\n                                    firstAvailableImageUrl = imageUrl;\n                                }\n                                console.log(`✓ Page ${page.pageNumber} image saved: ${imageUrl}`);\n                            } else {\n                                console.error(`Upload error for page ${page.pageNumber}:`, uploadError);\n                                // Continue without image for this page\n                                pagesWithImages.push({\n                                    pageNumber: page.pageNumber,\n                                    text: page.text,\n                                    imageUrl: null,\n                                    imageDescription: page.imageDescription\n                                });\n                            }\n                        } else {\n                            console.log(`No image data found for page ${page.pageNumber}`);\n                            pagesWithImages.push({\n                                pageNumber: page.pageNumber,\n                                text: page.text,\n                                imageUrl: null,\n                                imageDescription: page.imageDescription\n                            });\n                        }\n                    } catch (imageError) {\n                        console.error(`Image generation error for page ${page.pageNumber}:`, imageError.message);\n                        // Continue without image\n                        pagesWithImages.push({\n                            pageNumber: page.pageNumber,\n                            text: page.text,\n                            imageUrl: null,\n                            imageDescription: page.imageDescription\n                        });\n                    }\n                    // Add a small delay between image generations to avoid rate limits\n                    if (i < storyData.pages.length - 1) {\n                        await new Promise((resolve)=>setTimeout(resolve, 500));\n                    }\n                }\n                // Ensure we have a cover image - use first page if available, otherwise first available image\n                if (!coverImageUrl && firstAvailableImageUrl) {\n                    coverImageUrl = firstAvailableImageUrl;\n                    console.log(`✓ Using first available image as cover/thumbnail: ${coverImageUrl}`);\n                }\n                // Step 3: Save storybook to database\n                const storybookData = {\n                    title: storyData.title,\n                    pages: pagesWithImages,\n                    originalPrompt: basePrompt\n                };\n                console.log(\"=== Saving Storybook ===\");\n                console.log(\"Title:\", storybookData.title);\n                console.log(\"Cover/Thumbnail URL:\", coverImageUrl);\n                console.log(\"Number of pages:\", pagesWithImages.length);\n                const { data: inserted, error } = await db.from(\"content_items\").insert({\n                    profile_id: null,\n                    child_id: null,\n                    title: storybookData.title,\n                    category: body.category,\n                    type: \"story\",\n                    body: storybookData,\n                    cover_url: coverImageUrl,\n                    is_public: true\n                }).select().single();\n                if (error) {\n                    console.error(\"Database insert error:\", error);\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: error.message\n                    }, {\n                        status: 500\n                    });\n                }\n                console.log(\"=== Storybook Generated Successfully ===\");\n                console.log(\"Storybook ID:\", inserted.id);\n                console.log(\"Cover URL saved:\", inserted.cover_url);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    content: inserted\n                });\n            } catch (storybookError) {\n                console.error(\"=== Storybook Generation Error ===\");\n                console.error(\"Error:\", storybookError);\n                console.error(\"Stack:\", storybookError.stack);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: storybookError.message || \"Storybook generation failed\",\n                    details: storybookError.stack?.substring(0, 500)\n                }, {\n                    status: 500\n                });\n            }\n        }\n        // For other types, use text generation with Gemini\n        const genAI = (0,_lib_gemini__WEBPACK_IMPORTED_MODULE_2__.getGemini)();\n        const model = genAI.getGenerativeModel({\n            model: \"gemini-2.5-flash\"\n        });\n        let fullPrompt = \"You are a helper for parents of young children.\\n\\n\";\n        const basePrompt = body.prompt ?? \"Create a supportive, age-appropriate piece for a preschooler.\";\n        if (body.type === \"story\") {\n            fullPrompt += `${basePrompt}\\n\\nCreate a supportive personalized story for a child about this situation. Return ONLY valid JSON in this exact format: {\"title\": \"Story Title\", \"outline\": [\"point 1\", \"point 2\"], \"story_html\": \"<p>Full story HTML here</p>\"}`;\n        } else if (body.type === \"song_lyrics\") {\n            fullPrompt += `${basePrompt}\\n\\nCreate playful bedtime song lyrics only. Return ONLY valid JSON: {\"title\": \"Song Title\", \"lyrics\": \"Full lyrics text\", \"style\": \"lullaby\"}`;\n        } else if (body.type === \"schedule\" || body.type === \"calendar\") {\n            fullPrompt += `${basePrompt}\\n\\nCreate a simple schedule. Return ONLY valid JSON: {\"title\": \"Schedule Title\", \"items\": [{\"time\": \"9:00 AM\", \"label\": \"Activity\"}]}`;\n        }\n        fullPrompt += \"\\n\\nImportant: Return ONLY the JSON object, no markdown code blocks, no explanation text.\";\n        const completion = await model.generateContent(fullPrompt);\n        let text = completion.response.text();\n        // Clean up markdown code blocks if present\n        text = text.trim();\n        if (text.startsWith(\"```json\")) {\n            text = text.replace(/^```json\\s*/, \"\").replace(/\\s*```$/, \"\");\n        } else if (text.startsWith(\"```\")) {\n            text = text.replace(/^```\\s*/, \"\").replace(/\\s*```$/, \"\");\n        }\n        let parsed;\n        try {\n            parsed = JSON.parse(text);\n        } catch (parseError) {\n            console.error(\"JSON parse error:\", parseError, \"Text was:\", text.substring(0, 200));\n            // Fallback: create a simple structure\n            parsed = {\n                title: \"Generated Story\",\n                outline: [\n                    \"Introduction\",\n                    \"Main story\",\n                    \"Conclusion\"\n                ],\n                story_html: `<p>${text.replace(/\\n/g, \"</p><p>\")}</p>`\n            };\n        }\n        const { data: inserted, error } = await db.from(\"content_items\").insert({\n            profile_id: null,\n            child_id: null,\n            title: parsed.title ?? \"Generated\",\n            category: body.category,\n            type: body.type,\n            body: parsed,\n            is_public: true\n        }).select().single();\n        if (error) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: error.message\n        }, {\n            status: 500\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            content: inserted\n        });\n    } catch (e) {\n        console.error(\"=== Generate Error ===\");\n        console.error(\"Error message:\", e.message);\n        console.error(\"Error stack:\", e.stack);\n        console.error(\"Error details:\", e);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: e.message || \"Generation failed\",\n            details: e.stack?.substring(0, 500)\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Z0JBQWdCZ0ksRUFBRUosS0FBSztRQUNyQ25HLFFBQVF6QixLQUFLLENBQUMsa0JBQWtCZ0k7UUFDaEMsT0FBT3pJLHFEQUFZQSxDQUFDUSxJQUFJLENBQUM7WUFDdkJDLE9BQU9nSSxFQUFFOUQsT0FBTyxJQUFJO1lBQ3BCZ0MsU0FBUzhCLEVBQUVKLEtBQUssRUFBRS9FLFVBQVUsR0FBRztRQUNqQyxHQUFHO1lBQUU1QyxRQUFRO1FBQUk7SUFDbkI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2thcmFza2lkZG9zLy4vYXBwL2FwaS9jb250ZW50L2dlbmVyYXRlL3JvdXRlLnRzPzI2YmIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XG5pbXBvcnQgeyBnZXRTZXJ2aWNlQ2xpZW50IH0gZnJvbSBcIkAvbGliL3N1cGFiYXNlL3NlcnZlclwiO1xuaW1wb3J0IHsgZ2V0R2VtaW5pIH0gZnJvbSBcIkAvbGliL2dlbWluaVwiO1xuXG50eXBlIEdlbmVyYXRlQm9keSA9IHtcbiAgY2F0ZWdvcnk6IFwiYmVkdGltZVwiIHwgXCJnZXR0aW5nX291dF90aGVfZG9vclwiIHwgXCJjaG9yZXNcIiB8IFwibmV3X3NpdHVhdGlvbnNcIjtcbiAgdHlwZTogXCJjaGVja2xpc3RcIiB8IFwic3RvcnlcIiB8IFwic29uZ19seXJpY3NcIiB8IFwic2NoZWR1bGVcIiB8IFwiY2FsZW5kYXJcIiB8IFwic3Rvcnlib29rXCI7XG4gIGNoaWxkSWQ/OiBzdHJpbmc7XG4gIHByb21wdD86IHN0cmluZztcbiAgLy8gUmF3IGZvcm0gZGF0YSBmb3IgY2hlY2tsaXN0c1xuICBmYXZvcml0ZVRoaW5nPzogc3RyaW5nO1xuICByb3V0aW5lSXRlbXM/OiBzdHJpbmdbXTtcbn07XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcTogUmVxdWVzdCkge1xuICB0cnkge1xuICAgIGlmICghcHJvY2Vzcy5lbnYuR0VNSU5JX0FQSV9LRVkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIkdFTUlOSV9BUElfS0VZIG5vdCBjb25maWd1cmVkXCIgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgICB9XG4gICAgaWYgKCFwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgfHwgIXByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIlN1cGFiYXNlIG5vdCBjb25maWd1cmVkXCIgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBib2R5ID0gKGF3YWl0IHJlcS5qc29uKCkpIGFzIEdlbmVyYXRlQm9keTtcbiAgICBjb25zdCBkYiA9IGdldFNlcnZpY2VDbGllbnQoKTtcblxuICAgIC8vIEZvciBjaGVja2xpc3QgdHlwZSwgZ2VuZXJhdGUgYW4gaW1hZ2UgdXNpbmcgR2VtaW5pIDIuNSBGbGFzaFxuICAgIGlmIChib2R5LnR5cGUgPT09IFwiY2hlY2tsaXN0XCIpIHtcbiAgICAgIC8vIEdldCBmYXZvcml0ZSB0aGluZyBhbmQgcm91dGluZSBpdGVtcyBmcm9tIGZvcm0gZGF0YVxuICAgICAgY29uc3QgZmF2b3JpdGVUaGluZyA9IGJvZHkuZmF2b3JpdGVUaGluZyB8fCBcInVuaWNvcm5cIjtcbiAgICAgIGNvbnN0IHJvdXRpbmVJdGVtcyA9IGJvZHkucm91dGluZUl0ZW1zICYmIGJvZHkucm91dGluZUl0ZW1zLmxlbmd0aCA+IDAgXG4gICAgICAgID8gYm9keS5yb3V0aW5lSXRlbXMuZmlsdGVyKChpdGVtOiBzdHJpbmcpID0+IGl0ZW0udHJpbSgpICE9PSBcIlwiKVxuICAgICAgICA6IFtcImJydXNoIHRlZXRoXCIsIFwicHV0IG9uIHBhamFtYXNcIiwgXCJyZWFkIGJvb2tcIl07XG4gICAgICBcbiAgICAgIC8vIEJ1aWxkIHRoZSBjaGVja2xpc3QgbmFtZVxuICAgICAgY29uc3QgY2hlY2tsaXN0TmFtZSA9IGBSaGVhIHRoZSAke2Zhdm9yaXRlVGhpbmd9IGdvZXMgdG8gYmVkYDtcbiAgICAgIFxuICAgICAgLy8gQnVpbGQgdGhlIGltYWdlcnkgZGVzY3JpcHRpb25zIGZvciBlYWNoIHJvdXRpbmUgaXRlbSB3aXRoIGNvbG9yZnVsIGRlc2NyaXB0aW9uc1xuICAgICAgY29uc3QgaW1hZ2VyeURlc2NyaXB0aW9ucyA9IHJvdXRpbmVJdGVtcy5tYXAoKGl0ZW06IHN0cmluZywgaW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgICBjb25zdCBpdGVtTnVtID0gaW5kZXggKyAxO1xuICAgICAgICBjb25zdCBpc0ZpcnN0ID0gaW5kZXggPT09IDA7XG4gICAgICAgIGNvbnN0IGlzTGFzdCA9IGluZGV4ID09PSByb3V0aW5lSXRlbXMubGVuZ3RoIC0gMTtcbiAgICAgICAgXG4gICAgICAgIC8vIEFkZCBjb2xvcmZ1bCBkZXNjcmlwdGlvbnMgYmFzZWQgb24gcG9zaXRpb25cbiAgICAgICAgbGV0IGRlc2NyaXB0aW9uID0gXCJcIjtcbiAgICAgICAgaWYgKGlzRmlyc3QpIHtcbiAgICAgICAgICBkZXNjcmlwdGlvbiA9IGB3aXRoIGEgcHJvdWQgc21pbGUgb24gdGhlaXIgZmFjZS4gVXNlIGJyaWdodCBjb2xvcmZ1bCBjb2xvcnMuYDtcbiAgICAgICAgfSBlbHNlIGlmIChpc0xhc3QpIHtcbiAgICAgICAgICAvLyBTcGVjaWFsIGhhbmRsaW5nIGZvciByZWFkaW5nL2Jvb2sgaXRlbXNcbiAgICAgICAgICBpZiAoaXRlbS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdyZWFkJykgfHwgaXRlbS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdib29rJykpIHtcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gYGluIGJlZCB3aXRoIHRoZWlyIGV5ZXMgY2xvc2VkLCBsb29raW5nIHBlYWNlZnVsIGFuZCBzbGVlcHkuYDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGVzY3JpcHRpb24gPSBgd2l0aCBhIGhhcHB5LCBjb250ZW50IGV4cHJlc3Npb24uYDtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoaW5kZXggPT09IDEpIHtcbiAgICAgICAgICBkZXNjcmlwdGlvbiA9IGBidXQgc3RydWdnbGluZyB3aXRoIGl0LCBsb29raW5nIGRldGVybWluZWQuYDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkZXNjcmlwdGlvbiA9IGB3aXRoIGZvY3VzZWQgY29uY2VudHJhdGlvbi5gO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gYCR7aXRlbU51bX0pIE9uIHRoZSAke2lzRmlyc3QgPyAnZmlyc3QnIDogaXNMYXN0ICYmIHJvdXRpbmVJdGVtcy5sZW5ndGggPiAyID8gJ2xhc3QnIDogaXRlbU51bSA9PT0gMiA/ICdzZWNvbmQnIDogYCR7aXRlbU51bX10aGB9IHJvdywgaXQgc2hvdWxkIHNob3cgdGhlICR7ZmF2b3JpdGVUaGluZ30gJHtpdGVtfSAke2Rlc2NyaXB0aW9ufWA7XG4gICAgICB9KS5qb2luKCdcXG5cXG4nKTtcbiAgICAgIFxuICAgICAgY29uc3QgaW1hZ2VQcm9tcHQgPSBgQ3JlYXRlIGFuIGlsbHVzdHJhdGVkIGNoZWNrbGlzdC4gVGhpcyBjaGVja2xpc3Qgc2hvdWxkIGhhdmUgYSB3aGltc2ljYWwgdGhlbWUsIGFwcHJvcHJpYXRlIGZvciBsb29raW5nIGZ1bi9leGNpdGluZyB0byBhIDUgeWVhciBvbGQuIE1ha2UgdGhlIHByb3RhZ29uaXN0IGEgJHtmYXZvcml0ZVRoaW5nfSwgZXhjaXRlZCB0byBkbyBlYWNoIG9mIHRoZSBzdGVwcy4gTWFrZSBpdCBsb29rIHByb2Zlc3Npb25hbGx5IGlsbHVzdHJhdGVkIGJ5IGEgY2hpbGRyZW4ncyBib29rIGF1dGhvciBsaWtlIEhvbGxpZSBNZW5nZXJ0LlxuXG5UaGUgbmFtZSBvZiB0aGUgY2hlY2tsaXN0IHNob3VsZCBiZTogJHtjaGVja2xpc3ROYW1lfVxuXG5PbiB0aGUgbGVmdCBjb2x1bW4sIHRoZSBjaGVja2xpc3Qgc2hvdWxkIGhhdmUgaW1hZ2VyeTpcblxuJHtpbWFnZXJ5RGVzY3JpcHRpb25zfVxuXG5NYWtlIHRoZSAke2Zhdm9yaXRlVGhpbmd9IGltYWdlcyB0YWtlIHVwIGhhbGYgdGhlIHBhZ2UuXG5cbk9uIHRoZSByaWdodCBjb2x1bW4sIGl0IHNob3VsZCBqdXN0IGZlYXR1cmUgJHtyb3V0aW5lSXRlbXMubGVuZ3RofSBibGFuayByb3dzIChzbyB0aGF0IHRoZSBjaGlsZCBjYW4gd3JpdGUgaW4gdGhlbSlcblxuTWFrZSBpdCBnb29kIWA7XG5cbiAgICAgIGNvbnNvbGUubG9nKFwiSW1hZ2UgUHJvbXB0OlwiLCBpbWFnZVByb21wdCk7XG4gICAgICBjb25zb2xlLmxvZyhcIj09PT09PT09PT09PT09PT09PT09PT1cIik7XG5cbiAgICAgIC8vIFVzZSBHZW1pbmkgMi41IEZsYXNoIEltYWdlIGZvciBpbWFnZSBnZW5lcmF0aW9uXG4gICAgICAvLyBSZWZlcmVuY2U6IGh0dHBzOi8vYWkuZ29vZ2xlLmRldi9nZW1pbmktYXBpL2RvY3MvaW1hZ2UtZ2VuZXJhdGlvbiNqYXZhc2NyaXB0XG4gICAgICBcbiAgICAgIGxldCBpbWFnZVVybDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gICAgICBcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGdlbkFJID0gZ2V0R2VtaW5pKCk7XG4gICAgICAgIC8vIFVzZSB0aGUgY29ycmVjdCBtb2RlbCBuYW1lIGZvciBpbWFnZSBnZW5lcmF0aW9uXG4gICAgICAgIGNvbnN0IG1vZGVsID0gZ2VuQUkuZ2V0R2VuZXJhdGl2ZU1vZGVsKHsgXG4gICAgICAgICAgbW9kZWw6IFwiZ2VtaW5pLTIuNS1mbGFzaC1pbWFnZVwiXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coXCI9PT0gQ2FsbGluZyBHZW1pbmkgZm9yIEltYWdlIEdlbmVyYXRpb24gPT09XCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIk1vZGVsOiBnZW1pbmktMi41LWZsYXNoLWltYWdlXCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIkltYWdlIFByb21wdDpcIiwgaW1hZ2VQcm9tcHQpO1xuICAgICAgICBcbiAgICAgICAgLy8gR2VuZXJhdGUgaW1hZ2UgdXNpbmcgR2VtaW5pIDIuNSBGbGFzaCBJbWFnZVxuICAgICAgICBjb25zdCBjb21wbGV0aW9uID0gYXdhaXQgbW9kZWwuZ2VuZXJhdGVDb250ZW50KGltYWdlUHJvbXB0KTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gY29tcGxldGlvbi5yZXNwb25zZTtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKFwiPT09IEdlbWluaSBSZXNwb25zZSA9PT1cIik7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiQ2FuZGlkYXRlczpcIiwgcmVzcG9uc2UuY2FuZGlkYXRlcz8ubGVuZ3RoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIENoZWNrIGZvciBpbWFnZSBkYXRhIGluIHRoZSByZXNwb25zZSBwYXJ0c1xuICAgICAgICBsZXQgYmFzZTY0SW1hZ2U6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICAgICAgICBcbiAgICAgICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGFsbCBwYXJ0cyBpbiB0aGUgcmVzcG9uc2VcbiAgICAgICAgaWYgKHJlc3BvbnNlLmNhbmRpZGF0ZXM/LlswXT8uY29udGVudD8ucGFydHMpIHtcbiAgICAgICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgcmVzcG9uc2UuY2FuZGlkYXRlc1swXS5jb250ZW50LnBhcnRzKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlBhcnQga2V5czpcIiwgT2JqZWN0LmtleXMocGFydCkpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDaGVjayBmb3IgaW5saW5lRGF0YSAoaW1hZ2UgZGF0YSlcbiAgICAgICAgICAgIGlmIChwYXJ0LmlubGluZURhdGEpIHtcbiAgICAgICAgICAgICAgYmFzZTY0SW1hZ2UgPSBwYXJ0LmlubGluZURhdGEuZGF0YTtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJGb3VuZCBpbWFnZSBpbiBpbmxpbmVEYXRhLCBtaW1lVHlwZTpcIiwgcGFydC5pbmxpbmVEYXRhLm1pbWVUeXBlKTtcbiAgICAgICAgICAgICAgYnJlYWs7IC8vIEZvdW5kIHRoZSBpbWFnZSwgbm8gbmVlZCB0byBjaGVjayBvdGhlciBwYXJ0c1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDaGVjayBmb3IgdGV4dCAobWlnaHQgY29udGFpbiBpbWFnZSBkZXNjcmlwdGlvbiBvciBVUkwpXG4gICAgICAgICAgICBpZiAocGFydC50ZXh0KSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUGFydCB0ZXh0IHByZXZpZXc6XCIsIHBhcnQudGV4dC5zdWJzdHJpbmcoMCwgMjAwKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZyhcIkJhc2U2NCBpbWFnZSBmb3VuZDpcIiwgYmFzZTY0SW1hZ2UgPyBcIlllc1wiIDogXCJOb1wiKTtcbiAgICAgICAgY29uc29sZS5sb2coXCI9PT09PT09PT09PT09PT09PT09PT09XCIpO1xuXG4gICAgICAgIC8vIElmIHdlIGhhdmUgYSBiYXNlNjQgaW1hZ2UsIHNhdmUgaXQgdG8gU3VwYWJhc2UgU3RvcmFnZVxuICAgICAgICBpZiAoYmFzZTY0SW1hZ2UpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgaW1hZ2VCdWZmZXIgPSBCdWZmZXIuZnJvbShiYXNlNjRJbWFnZSwgXCJiYXNlNjRcIik7XG4gICAgICAgICAgICBjb25zdCBmaWxlTmFtZSA9IGBjaGVja2xpc3RzLyR7RGF0ZS5ub3coKX0tJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoNyl9LnBuZ2A7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHsgZGF0YTogdXBsb2FkRGF0YSwgZXJyb3I6IHVwbG9hZEVycm9yIH0gPSBhd2FpdCBkYi5zdG9yYWdlXG4gICAgICAgICAgICAgIC5mcm9tKFwiY2hlY2tsaXN0c1wiKVxuICAgICAgICAgICAgICAudXBsb2FkKGZpbGVOYW1lLCBpbWFnZUJ1ZmZlciwge1xuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBcImltYWdlL3BuZ1wiLFxuICAgICAgICAgICAgICAgIHVwc2VydDogZmFsc2UsXG4gICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoIXVwbG9hZEVycm9yICYmIHVwbG9hZERhdGEpIHtcbiAgICAgICAgICAgICAgY29uc3QgeyBkYXRhOiB1cmxEYXRhIH0gPSBkYi5zdG9yYWdlXG4gICAgICAgICAgICAgICAgLmZyb20oXCJjaGVja2xpc3RzXCIpXG4gICAgICAgICAgICAgICAgLmdldFB1YmxpY1VybChmaWxlTmFtZSk7XG4gICAgICAgICAgICAgIGltYWdlVXJsID0gdXJsRGF0YS5wdWJsaWNVcmw7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSW1hZ2Ugc2F2ZWQgdG8gU3VwYWJhc2UgU3RvcmFnZTpcIiwgaW1hZ2VVcmwpO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIvCflJcgRGlyZWN0IGxpbmsgdG8gZ2VuZXJhdGVkIGltYWdlOlwiLCBpbWFnZVVybCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiU3RvcmFnZSB1cGxvYWQgZXJyb3I6XCIsIHVwbG9hZEVycm9yKTtcbiAgICAgICAgICAgICAgLy8gRmFsbGJhY2sgdG8gZGF0YSBVUkwgaWYgc3RvcmFnZSBmYWlsc1xuICAgICAgICAgICAgICBpbWFnZVVybCA9IGBkYXRhOmltYWdlL3BuZztiYXNlNjQsJHtiYXNlNjRJbWFnZX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKHN0b3JhZ2VFcnJvcjogYW55KSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiU3RvcmFnZSBlcnJvcjpcIiwgc3RvcmFnZUVycm9yKTtcbiAgICAgICAgICAgIGltYWdlVXJsID0gYGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCwke2Jhc2U2NEltYWdlfWA7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiTm8gaW1hZ2UgZGF0YSBmb3VuZCBpbiBHZW1pbmkgcmVzcG9uc2VcIik7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGltYWdlRXJyb3I6IGFueSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiSW1hZ2UgZ2VuZXJhdGlvbiBlcnJvcjpcIiwgaW1hZ2VFcnJvci5tZXNzYWdlIHx8IGltYWdlRXJyb3IpO1xuICAgICAgICAvLyBDb250aW51ZSB3aXRob3V0IGltYWdlIC0gd2UnbGwgc3RpbGwgY3JlYXRlIHRoZSBjaGVja2xpc3RcbiAgICAgIH1cblxuICAgICAgLy8gQnVpbGQgc3RlcHMgZnJvbSB0aGUgc2FtZSByb3V0aW5lSXRlbXMgd2UgdXNlZCBmb3IgdGhlIGltYWdlIHByb21wdFxuICAgICAgY29uc3Qgc3RlcHMgPSByb3V0aW5lSXRlbXMubWFwKChpdGVtOiBzdHJpbmcpID0+ICh7XG4gICAgICAgIGxhYmVsOiBpdGVtLnRyaW0oKSxcbiAgICAgICAgdGlwOiBgR3JlYXQgam9iIG9uICR7aXRlbS50cmltKCl9IWAsXG4gICAgICB9KSk7XG5cbiAgICAgIGNvbnN0IHBhcnNlZCA9IHtcbiAgICAgICAgdGl0bGU6IGNoZWNrbGlzdE5hbWUsXG4gICAgICAgIHN0ZXBzLFxuICAgICAgICBpbWFnZV91cmw6IGltYWdlVXJsLFxuICAgICAgICBpbWFnZV9wcm9tcHQ6IGltYWdlUHJvbXB0LFxuICAgICAgfTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgeyBkYXRhOiBpbnNlcnRlZCwgZXJyb3IgfSA9IGF3YWl0IGRiXG4gICAgICAgICAgLmZyb20oXCJjb250ZW50X2l0ZW1zXCIpXG4gICAgICAgICAgLmluc2VydCh7XG4gICAgICAgICAgICBwcm9maWxlX2lkOiBudWxsLFxuICAgICAgICAgICAgY2hpbGRfaWQ6IG51bGwsXG4gICAgICAgICAgICB0aXRsZTogcGFyc2VkLnRpdGxlLFxuICAgICAgICAgICAgY2F0ZWdvcnk6IGJvZHkuY2F0ZWdvcnksXG4gICAgICAgICAgICB0eXBlOiBib2R5LnR5cGUsXG4gICAgICAgICAgICBib2R5OiBwYXJzZWQsXG4gICAgICAgICAgICBjb3Zlcl91cmw6IGltYWdlVXJsLFxuICAgICAgICAgICAgaXNfcHVibGljOiB0cnVlLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLnNpbmdsZSgpO1xuXG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJEYXRhYmFzZSBpbnNlcnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGNvbnRlbnQ6IGluc2VydGVkIH0pO1xuICAgICAgfSBjYXRjaCAoZGJFcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJEYXRhYmFzZSBlcnJvcjpcIiwgZGJFcnJvcik7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBkYkVycm9yLm1lc3NhZ2UgfHwgXCJEYXRhYmFzZSBlcnJvclwiIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRm9yIHN0b3J5Ym9vayB0eXBlLCBnZW5lcmF0ZSBhIDEwLXBhZ2UgaWxsdXN0cmF0ZWQgc3Rvcnlib29rXG4gICAgaWYgKGJvZHkudHlwZSA9PT0gXCJzdG9yeWJvb2tcIikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZ2VuQUkgPSBnZXRHZW1pbmkoKTtcbiAgICAgICAgY29uc3QgdGV4dE1vZGVsID0gZ2VuQUkuZ2V0R2VuZXJhdGl2ZU1vZGVsKHsgbW9kZWw6IFwiZ2VtaW5pLTIuNS1mbGFzaFwiIH0pO1xuICAgICAgICBjb25zdCBpbWFnZU1vZGVsID0gZ2VuQUkuZ2V0R2VuZXJhdGl2ZU1vZGVsKHsgbW9kZWw6IFwiZ2VtaW5pLTIuNS1mbGFzaC1pbWFnZVwiIH0pO1xuXG4gICAgICBjb25zdCBiYXNlUHJvbXB0ID0gYm9keS5wcm9tcHQgfHwgXCJDcmVhdGUgYSBmdW4sIGVudGVydGFpbmluZyBzdG9yeSBmb3IgYSA1LXllYXItb2xkIHdpdGggYSBjb25mbGljdCB0aGF0IGdldHMgcmVzb2x2ZWQgYXQgdGhlIGVuZC5cIjtcbiAgICAgIFxuICAgICAgLy8gU3RlcCAxOiBHZW5lcmF0ZSB0aGUgc3Rvcnkgc3RydWN0dXJlICgxMCBwYWdlcylcbiAgICAgIGNvbnN0IHN0b3J5UHJvbXB0ID0gYCR7YmFzZVByb21wdH1cblxuQ3JlYXRlIGEgcHJvZmVzc2lvbmFsLCB3aGltc2ljYWwgMTAtcGFnZSBzdG9yeWJvb2sgZm9yIGEgNS15ZWFyLW9sZCBjaGlsZC4gVGhlIHN0b3J5IHNob3VsZDpcbi0gSGF2ZSBhIGNsZWFyIGNvbmZsaWN0IHRoYXQgZ2V0cyByZXNvbHZlZCBieSB0aGUgZW5kXG4tIEJlIGVudGVydGFpbmluZyBhbmQgYWdlLWFwcHJvcHJpYXRlXG4tIEJlIHByb2Zlc3Npb25hbCBhbmQgd2hpbXNpY2FsIGluIHN0eWxlLCBsaWtlIHRoZSBpbGx1c3RyYXRpb25zIGJ5IEhvbGxpZSBNZW5nZXJ0IG9yIERhbmllbCBTYWxtaWVyaVxuLSBFYWNoIHBhZ2Ugc2hvdWxkIGhhdmUgMi0zIHNlbnRlbmNlcyBvZiB0ZXh0XG5cbklNUE9SVEFOVCBGT1IgSUxMVVNUUkFUSU9OUzpcbi0gQWxsIGlsbHVzdHJhdGlvbnMgbXVzdCB1c2UgdGhlIFNBTUUgZHJhd2luZyBzdHlsZSBhY3Jvc3MgYWxsIDEwIHBhZ2VzXG4tIFRoZSBwcm90YWdvbmlzdCBtdXN0IGxvb2sgRVhBQ1RMWSB0aGUgc2FtZSBpbiBldmVyeSBpbGx1c3RyYXRpb24gKHNhbWUgYXBwZWFyYW5jZSwgY2xvdGhpbmcsIGNvbG9ycywgcGh5c2ljYWwgZmVhdHVyZXMpXG4tIFRoZSBhcnRpc3RpYyBzdHlsZSBzaG91bGQgYmUgcHJvZmVzc2lvbmFsIGFuZCB3aGltc2ljYWwsIGNvbnNpc3RlbnQgdGhyb3VnaG91dCB0aGUgZW50aXJlIHN0b3J5Ym9va1xuXG5SZXR1cm4gT05MWSB2YWxpZCBKU09OIGluIHRoaXMgZXhhY3QgZm9ybWF0Olxue1xuICBcInRpdGxlXCI6IFwiU3RvcnkgVGl0bGVcIixcbiAgXCJwcm90YWdvbmlzdERlc2NyaXB0aW9uXCI6IFwiRGV0YWlsZWQgZGVzY3JpcHRpb24gb2YgdGhlIHByb3RhZ29uaXN0J3MgYXBwZWFyYW5jZSwgaW5jbHVkaW5nIHBoeXNpY2FsIGZlYXR1cmVzLCBjbG90aGluZywgY29sb3JzLCBhbmQgYW55IGRpc3RpbmN0aXZlIGNoYXJhY3RlcmlzdGljcy4gVGhpcyBkZXNjcmlwdGlvbiB3aWxsIGJlIHVzZWQgdG8gZW5zdXJlIHRoZSBwcm90YWdvbmlzdCBsb29rcyBpZGVudGljYWwgYWNyb3NzIGFsbCAxMCBwYWdlcy5cIixcbiAgXCJwYWdlc1wiOiBbXG4gICAge1wicGFnZU51bWJlclwiOiAxLCBcInRleHRcIjogXCJQYWdlIDEgdGV4dCBoZXJlXCIsIFwiaW1hZ2VEZXNjcmlwdGlvblwiOiBcIkRldGFpbGVkIGRlc2NyaXB0aW9uIG9mIHdoYXQgc2hvdWxkIGJlIGlsbHVzdHJhdGVkIG9uIHRoaXMgcGFnZVwifSxcbiAgICB7XCJwYWdlTnVtYmVyXCI6IDIsIFwidGV4dFwiOiBcIlBhZ2UgMiB0ZXh0IGhlcmVcIiwgXCJpbWFnZURlc2NyaXB0aW9uXCI6IFwiRGV0YWlsZWQgZGVzY3JpcHRpb24uLi5cIn0sXG4gICAgLi4uICgxMCBwYWdlcyB0b3RhbClcbiAgXVxufVxuXG5JbXBvcnRhbnQ6IFJldHVybiBPTkxZIHRoZSBKU09OIG9iamVjdCwgbm8gbWFya2Rvd24gY29kZSBibG9ja3MsIG5vIGV4cGxhbmF0aW9uIHRleHQuYDtcblxuICAgICAgY29uc29sZS5sb2coXCI9PT0gR2VuZXJhdGluZyBTdG9yeWJvb2sgU3RydWN0dXJlID09PVwiKTtcbiAgICAgIGNvbnN0IHN0b3J5Q29tcGxldGlvbiA9IGF3YWl0IHRleHRNb2RlbC5nZW5lcmF0ZUNvbnRlbnQoc3RvcnlQcm9tcHQpO1xuICAgICAgbGV0IHN0b3J5VGV4dCA9IHN0b3J5Q29tcGxldGlvbi5yZXNwb25zZS50ZXh0KCk7XG4gICAgICBcbiAgICAgIC8vIENsZWFuIHVwIG1hcmtkb3duIGNvZGUgYmxvY2tzXG4gICAgICBzdG9yeVRleHQgPSBzdG9yeVRleHQudHJpbSgpO1xuICAgICAgaWYgKHN0b3J5VGV4dC5zdGFydHNXaXRoKFwiYGBganNvblwiKSkge1xuICAgICAgICBzdG9yeVRleHQgPSBzdG9yeVRleHQucmVwbGFjZSgvXmBgYGpzb25cXHMqLywgXCJcIikucmVwbGFjZSgvXFxzKmBgYCQvLCBcIlwiKTtcbiAgICAgIH0gZWxzZSBpZiAoc3RvcnlUZXh0LnN0YXJ0c1dpdGgoXCJgYGBcIikpIHtcbiAgICAgICAgc3RvcnlUZXh0ID0gc3RvcnlUZXh0LnJlcGxhY2UoL15gYGBcXHMqLywgXCJcIikucmVwbGFjZSgvXFxzKmBgYCQvLCBcIlwiKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgbGV0IHN0b3J5RGF0YTogYW55O1xuICAgICAgdHJ5IHtcbiAgICAgICAgc3RvcnlEYXRhID0gSlNPTi5wYXJzZShzdG9yeVRleHQpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIlBhcnNlZCBzdG9yeSBkYXRhOlwiLCBKU09OLnN0cmluZ2lmeShzdG9yeURhdGEsIG51bGwsIDIpLnN1YnN0cmluZygwLCA1MDApKTtcbiAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3I6IGFueSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiU3RvcnkgSlNPTiBwYXJzZSBlcnJvcjpcIiwgcGFyc2VFcnJvcik7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJSYXcgc3RvcnkgdGV4dDpcIiwgc3RvcnlUZXh0LnN1YnN0cmluZygwLCA1MDApKTtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgXG4gICAgICAgICAgZXJyb3I6IFwiRmFpbGVkIHRvIHBhcnNlIHN0b3J5IHN0cnVjdHVyZVwiLCBcbiAgICAgICAgICBkZXRhaWxzOiBwYXJzZUVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgcmF3VGV4dDogc3RvcnlUZXh0LnN1YnN0cmluZygwLCAyMDApXG4gICAgICAgIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmICghc3RvcnlEYXRhLnBhZ2VzIHx8ICFBcnJheS5pc0FycmF5KHN0b3J5RGF0YS5wYWdlcykpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkludmFsaWQgcGFnZXMgZGF0YTpcIiwgc3RvcnlEYXRhKTtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgXG4gICAgICAgICAgZXJyb3I6IFwiU3Rvcnkgc3RydWN0dXJlIG1pc3NpbmcgcGFnZXMgYXJyYXlcIixcbiAgICAgICAgICByZWNlaXZlZDogT2JqZWN0LmtleXMoc3RvcnlEYXRhKVxuICAgICAgICB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoc3RvcnlEYXRhLnBhZ2VzLmxlbmd0aCAhPT0gMTApIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgRXhwZWN0ZWQgMTAgcGFnZXMsIGdvdCAke3N0b3J5RGF0YS5wYWdlcy5sZW5ndGh9YCk7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IFxuICAgICAgICAgIGVycm9yOiBgU3RvcnkgbXVzdCBoYXZlIGV4YWN0bHkgMTAgcGFnZXMsIGdvdCAke3N0b3J5RGF0YS5wYWdlcy5sZW5ndGh9YCBcbiAgICAgICAgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coYEdlbmVyYXRlZCBzdG9yeSBzdHJ1Y3R1cmU6ICR7c3RvcnlEYXRhLnRpdGxlfSB3aXRoICR7c3RvcnlEYXRhLnBhZ2VzLmxlbmd0aH0gcGFnZXNgKTtcbiAgICAgIGNvbnNvbGUubG9nKGBQcm90YWdvbmlzdCBkZXNjcmlwdGlvbjogJHtzdG9yeURhdGEucHJvdGFnb25pc3REZXNjcmlwdGlvbiA/IFwiUHJlc2VudFwiIDogXCJNaXNzaW5nIChvcHRpb25hbClcIn1gKTtcblxuICAgICAgLy8gU3RlcCAyOiBHZW5lcmF0ZSBpbWFnZXMgZm9yIGVhY2ggcGFnZVxuICAgICAgY29uc3QgcGFnZXNXaXRoSW1hZ2VzID0gW107XG4gICAgICBsZXQgY292ZXJJbWFnZVVybDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gICAgICBsZXQgZmlyc3RBdmFpbGFibGVJbWFnZVVybDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RvcnlEYXRhLnBhZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHBhZ2UgPSBzdG9yeURhdGEucGFnZXNbaV07XG4gICAgICAgIGNvbnNvbGUubG9nKGBHZW5lcmF0aW5nIGltYWdlIGZvciBwYWdlICR7cGFnZS5wYWdlTnVtYmVyfS4uLmApO1xuXG4gICAgICAgIC8vIEdldCBwcm90YWdvbmlzdCBkZXNjcmlwdGlvbiBmcm9tIHN0b3J5IGRhdGEgZm9yIGNvbnNpc3RlbmN5XG4gICAgICAgIGNvbnN0IHByb3RhZ29uaXN0RGVzYyA9IHN0b3J5RGF0YS5wcm90YWdvbmlzdERlc2NyaXB0aW9uIHx8IFwiXCI7XG4gICAgICAgIFxuICAgICAgICAvLyBCdWlsZCBzdHlsZSBjb25zaXN0ZW5jeSBpbnN0cnVjdGlvbnNcbiAgICAgICAgbGV0IHN0eWxlQ29uc2lzdGVuY3lOb3RlID0gXCJcIjtcbiAgICAgICAgaWYgKGkgPT09IDApIHtcbiAgICAgICAgICBzdHlsZUNvbnNpc3RlbmN5Tm90ZSA9IFwiVGhpcyBpcyB0aGUgZmlyc3QgcGFnZSAtIGVzdGFibGlzaCB0aGUgYXJ0aXN0aWMgc3R5bGUgdGhhdCB3aWxsIGJlIHVzZWQgY29uc2lzdGVudGx5IGFjcm9zcyBhbGwgMTAgcGFnZXMuXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3R5bGVDb25zaXN0ZW5jeU5vdGUgPSBcIkNSSVRJQ0FMOiBVc2UgdGhlIEVYQUNUIHNhbWUgYXJ0aXN0aWMgc3R5bGUsIGNvbG9yIHBhbGV0dGUsIGFuZCBpbGx1c3RyYXRpb24gdGVjaG5pcXVlIGFzIHBhZ2UgMS4gVGhlIGRyYXdpbmcgc3R5bGUgbXVzdCBiZSBpZGVudGljYWwgdG8gbWFpbnRhaW4gdmlzdWFsIGNvbnNpc3RlbmN5IHRocm91Z2hvdXQgdGhlIHN0b3J5Ym9vay5cIjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgaW1hZ2VQcm9tcHQgPSBgQ3JlYXRlIGEgcHJvZmVzc2lvbmFsLCB3aGltc2ljYWwgY2hpbGRyZW4ncyBib29rIGlsbHVzdHJhdGlvbiBpbiB0aGUgc3R5bGUgb2YgSG9sbGllIE1lbmdlcnQgb3IgRGFuaWVsIFNhbG1pZXJpLiBUaGUgaWxsdXN0cmF0aW9uIHNob3VsZCBiZTpcbi0gUHJvZmVzc2lvbmFsIGFuZCB3aGltc2ljYWwsIHdpdGggYSBjb2hlc2l2ZSBhcnRpc3RpYyBzdHlsZVxuLSBDb2xvcmZ1bCwgcGxheWZ1bCwgYW5kIHN1aXRhYmxlIGZvciBhIDUteWVhci1vbGRcbi0gSGlnaC1xdWFsaXR5LCBsaWtlIGEgcHVibGlzaGVkIHBpY3R1cmUgYm9va1xuXG4ke3N0eWxlQ29uc2lzdGVuY3lOb3RlfVxuXG4ke3Byb3RhZ29uaXN0RGVzYyA/IGBDUklUSUNBTDogVGhlIHByb3RhZ29uaXN0IG11c3QgbG9vayBleGFjdGx5IGxpa2UgdGhpcyBpbiBldmVyeSBpbGx1c3RyYXRpb246ICR7cHJvdGFnb25pc3REZXNjfS4gTWFrZSBzdXJlIHRoZSBwcm90YWdvbmlzdCdzIGFwcGVhcmFuY2UgKHBoeXNpY2FsIGZlYXR1cmVzLCBjbG90aGluZywgY29sb3JzLCBldGMuKSBpcyBpZGVudGljYWwgYWNyb3NzIGFsbCBwYWdlcy5gIDogXCJcIn1cblxuJHtwYWdlLmltYWdlRGVzY3JpcHRpb259XG5cbiR7cHJvdGFnb25pc3REZXNjID8gYFJlbWVtYmVyOiBUaGUgcHJvdGFnb25pc3QgbXVzdCBtYXRjaCB0aGUgZGVzY3JpcHRpb24gcHJvdmlkZWQgYWJvdmUgZXhhY3RseS5gIDogXCJcIn1cblxuTWFrZSBpdCBicmlnaHQsIGVuZ2FnaW5nLCBhbmQgcHJvZmVzc2lvbmFsLiBUaGUgaWxsdXN0cmF0aW9uIHNob3VsZCBmaWxsIHRoZSBlbnRpcmUgaW1hZ2UgYW5kIGJlIHN1aXRhYmxlIGZvciBhIHN0b3J5Ym9vayBwYWdlLiBFbnN1cmUgdGhlIGFydGlzdGljIHN0eWxlIGlzIGNvbnNpc3RlbnQgd2l0aCB0aGUgb3RoZXIgcGFnZXMgaW4gdGhpcyBzdG9yeWJvb2suYDtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGltYWdlQ29tcGxldGlvbiA9IGF3YWl0IGltYWdlTW9kZWwuZ2VuZXJhdGVDb250ZW50KGltYWdlUHJvbXB0KTtcbiAgICAgICAgICBjb25zdCBpbWFnZVJlc3BvbnNlID0gaW1hZ2VDb21wbGV0aW9uLnJlc3BvbnNlO1xuICAgICAgICAgIFxuICAgICAgICAgIGxldCBiYXNlNjRJbWFnZTogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gRXh0cmFjdCBpbWFnZSBmcm9tIHJlc3BvbnNlXG4gICAgICAgICAgaWYgKGltYWdlUmVzcG9uc2UuY2FuZGlkYXRlcz8uWzBdPy5jb250ZW50Py5wYXJ0cykge1xuICAgICAgICAgICAgZm9yIChjb25zdCBwYXJ0IG9mIGltYWdlUmVzcG9uc2UuY2FuZGlkYXRlc1swXS5jb250ZW50LnBhcnRzKSB7XG4gICAgICAgICAgICAgIGlmIChwYXJ0LmlubGluZURhdGEpIHtcbiAgICAgICAgICAgICAgICBiYXNlNjRJbWFnZSA9IHBhcnQuaW5saW5lRGF0YS5kYXRhO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGJhc2U2NEltYWdlKSB7XG4gICAgICAgICAgICAvLyBTYXZlIHRvIFN1cGFiYXNlIFN0b3JhZ2VcbiAgICAgICAgICAgIGNvbnN0IGltYWdlQnVmZmVyID0gQnVmZmVyLmZyb20oYmFzZTY0SW1hZ2UsIFwiYmFzZTY0XCIpO1xuICAgICAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBgc3Rvcnlib29rcy8ke0RhdGUubm93KCl9LSR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDcpfS1wYWdlLSR7cGFnZS5wYWdlTnVtYmVyfS5wbmdgO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCB7IGRhdGE6IHVwbG9hZERhdGEsIGVycm9yOiB1cGxvYWRFcnJvciB9ID0gYXdhaXQgZGIuc3RvcmFnZVxuICAgICAgICAgICAgICAuZnJvbShcImNoZWNrbGlzdHNcIikgLy8gVXNpbmcgY2hlY2tsaXN0cyBidWNrZXQgZm9yIG5vdywgY291bGQgY3JlYXRlIGEgc3Rvcnlib29rcyBidWNrZXRcbiAgICAgICAgICAgICAgLnVwbG9hZChmaWxlTmFtZSwgaW1hZ2VCdWZmZXIsIHtcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogXCJpbWFnZS9wbmdcIixcbiAgICAgICAgICAgICAgICB1cHNlcnQ6IGZhbHNlLFxuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKCF1cGxvYWRFcnJvciAmJiB1cGxvYWREYXRhKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHsgZGF0YTogdXJsRGF0YSB9ID0gZGIuc3RvcmFnZVxuICAgICAgICAgICAgICAgIC5mcm9tKFwiY2hlY2tsaXN0c1wiKVxuICAgICAgICAgICAgICAgIC5nZXRQdWJsaWNVcmwoZmlsZU5hbWUpO1xuICAgICAgICAgICAgICBjb25zdCBpbWFnZVVybCA9IHVybERhdGEucHVibGljVXJsO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgcGFnZXNXaXRoSW1hZ2VzLnB1c2goe1xuICAgICAgICAgICAgICAgIHBhZ2VOdW1iZXI6IHBhZ2UucGFnZU51bWJlcixcbiAgICAgICAgICAgICAgICB0ZXh0OiBwYWdlLnRleHQsXG4gICAgICAgICAgICAgICAgaW1hZ2VVcmw6IGltYWdlVXJsLFxuICAgICAgICAgICAgICAgIGltYWdlRGVzY3JpcHRpb246IHBhZ2UuaW1hZ2VEZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgLy8gVXNlIGZpcnN0IHBhZ2UgYXMgY292ZXIvdGh1bWJuYWlsXG4gICAgICAgICAgICAgIGlmIChwYWdlLnBhZ2VOdW1iZXIgPT09IDEpIHtcbiAgICAgICAgICAgICAgICBjb3ZlckltYWdlVXJsID0gaW1hZ2VVcmw7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYOKckyBDb3Zlci90aHVtYm5haWwgc2V0IGZyb20gcGFnZSAxOiAke2ltYWdlVXJsfWApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAvLyBUcmFjayBmaXJzdCBhdmFpbGFibGUgaW1hZ2UgYXMgZmFsbGJhY2tcbiAgICAgICAgICAgICAgaWYgKCFmaXJzdEF2YWlsYWJsZUltYWdlVXJsKSB7XG4gICAgICAgICAgICAgICAgZmlyc3RBdmFpbGFibGVJbWFnZVVybCA9IGltYWdlVXJsO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgY29uc29sZS5sb2coYOKckyBQYWdlICR7cGFnZS5wYWdlTnVtYmVyfSBpbWFnZSBzYXZlZDogJHtpbWFnZVVybH1gKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFVwbG9hZCBlcnJvciBmb3IgcGFnZSAke3BhZ2UucGFnZU51bWJlcn06YCwgdXBsb2FkRXJyb3IpO1xuICAgICAgICAgICAgICAvLyBDb250aW51ZSB3aXRob3V0IGltYWdlIGZvciB0aGlzIHBhZ2VcbiAgICAgICAgICAgICAgcGFnZXNXaXRoSW1hZ2VzLnB1c2goe1xuICAgICAgICAgICAgICAgIHBhZ2VOdW1iZXI6IHBhZ2UucGFnZU51bWJlcixcbiAgICAgICAgICAgICAgICB0ZXh0OiBwYWdlLnRleHQsXG4gICAgICAgICAgICAgICAgaW1hZ2VVcmw6IG51bGwsXG4gICAgICAgICAgICAgICAgaW1hZ2VEZXNjcmlwdGlvbjogcGFnZS5pbWFnZURlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYE5vIGltYWdlIGRhdGEgZm91bmQgZm9yIHBhZ2UgJHtwYWdlLnBhZ2VOdW1iZXJ9YCk7XG4gICAgICAgICAgICBwYWdlc1dpdGhJbWFnZXMucHVzaCh7XG4gICAgICAgICAgICAgIHBhZ2VOdW1iZXI6IHBhZ2UucGFnZU51bWJlcixcbiAgICAgICAgICAgICAgdGV4dDogcGFnZS50ZXh0LFxuICAgICAgICAgICAgICBpbWFnZVVybDogbnVsbCxcbiAgICAgICAgICAgICAgaW1hZ2VEZXNjcmlwdGlvbjogcGFnZS5pbWFnZURlc2NyaXB0aW9uLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChpbWFnZUVycm9yOiBhbnkpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGBJbWFnZSBnZW5lcmF0aW9uIGVycm9yIGZvciBwYWdlICR7cGFnZS5wYWdlTnVtYmVyfTpgLCBpbWFnZUVycm9yLm1lc3NhZ2UpO1xuICAgICAgICAgIC8vIENvbnRpbnVlIHdpdGhvdXQgaW1hZ2VcbiAgICAgICAgICBwYWdlc1dpdGhJbWFnZXMucHVzaCh7XG4gICAgICAgICAgICBwYWdlTnVtYmVyOiBwYWdlLnBhZ2VOdW1iZXIsXG4gICAgICAgICAgICB0ZXh0OiBwYWdlLnRleHQsXG4gICAgICAgICAgICBpbWFnZVVybDogbnVsbCxcbiAgICAgICAgICAgIGltYWdlRGVzY3JpcHRpb246IHBhZ2UuaW1hZ2VEZXNjcmlwdGlvbixcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFkZCBhIHNtYWxsIGRlbGF5IGJldHdlZW4gaW1hZ2UgZ2VuZXJhdGlvbnMgdG8gYXZvaWQgcmF0ZSBsaW1pdHNcbiAgICAgICAgaWYgKGkgPCBzdG9yeURhdGEucGFnZXMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MDApKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBFbnN1cmUgd2UgaGF2ZSBhIGNvdmVyIGltYWdlIC0gdXNlIGZpcnN0IHBhZ2UgaWYgYXZhaWxhYmxlLCBvdGhlcndpc2UgZmlyc3QgYXZhaWxhYmxlIGltYWdlXG4gICAgICBpZiAoIWNvdmVySW1hZ2VVcmwgJiYgZmlyc3RBdmFpbGFibGVJbWFnZVVybCkge1xuICAgICAgICBjb3ZlckltYWdlVXJsID0gZmlyc3RBdmFpbGFibGVJbWFnZVVybDtcbiAgICAgICAgY29uc29sZS5sb2coYOKckyBVc2luZyBmaXJzdCBhdmFpbGFibGUgaW1hZ2UgYXMgY292ZXIvdGh1bWJuYWlsOiAke2NvdmVySW1hZ2VVcmx9YCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFN0ZXAgMzogU2F2ZSBzdG9yeWJvb2sgdG8gZGF0YWJhc2VcbiAgICAgIGNvbnN0IHN0b3J5Ym9va0RhdGEgPSB7XG4gICAgICAgIHRpdGxlOiBzdG9yeURhdGEudGl0bGUsXG4gICAgICAgIHBhZ2VzOiBwYWdlc1dpdGhJbWFnZXMsXG4gICAgICAgIG9yaWdpbmFsUHJvbXB0OiBiYXNlUHJvbXB0LFxuICAgICAgfTtcblxuICAgICAgY29uc29sZS5sb2coXCI9PT0gU2F2aW5nIFN0b3J5Ym9vayA9PT1cIik7XG4gICAgICBjb25zb2xlLmxvZyhcIlRpdGxlOlwiLCBzdG9yeWJvb2tEYXRhLnRpdGxlKTtcbiAgICAgIGNvbnNvbGUubG9nKFwiQ292ZXIvVGh1bWJuYWlsIFVSTDpcIiwgY292ZXJJbWFnZVVybCk7XG4gICAgICBjb25zb2xlLmxvZyhcIk51bWJlciBvZiBwYWdlczpcIiwgcGFnZXNXaXRoSW1hZ2VzLmxlbmd0aCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHsgZGF0YTogaW5zZXJ0ZWQsIGVycm9yIH0gPSBhd2FpdCBkYlxuICAgICAgICAuZnJvbShcImNvbnRlbnRfaXRlbXNcIilcbiAgICAgICAgLmluc2VydCh7XG4gICAgICAgICAgcHJvZmlsZV9pZDogbnVsbCxcbiAgICAgICAgICBjaGlsZF9pZDogbnVsbCxcbiAgICAgICAgICB0aXRsZTogc3Rvcnlib29rRGF0YS50aXRsZSxcbiAgICAgICAgICBjYXRlZ29yeTogYm9keS5jYXRlZ29yeSxcbiAgICAgICAgICB0eXBlOiBcInN0b3J5XCIsIC8vIFVzaW5nIFwic3RvcnlcIiB0eXBlIHNpbmNlIFwic3Rvcnlib29rXCIgaXNuJ3QgaW4gdGhlIGVudW0geWV0XG4gICAgICAgICAgYm9keTogc3Rvcnlib29rRGF0YSxcbiAgICAgICAgICBjb3Zlcl91cmw6IGNvdmVySW1hZ2VVcmwsIC8vIFRoaXMgaXMgdGhlIHRodW1ibmFpbCBmcm9tIHRoZSBmaXJzdCBwYWdlIGltYWdlXG4gICAgICAgICAgaXNfcHVibGljOiB0cnVlLFxuICAgICAgICB9KVxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLnNpbmdsZSgpO1xuXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkRhdGFiYXNlIGluc2VydCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZyhcIj09PSBTdG9yeWJvb2sgR2VuZXJhdGVkIFN1Y2Nlc3NmdWxseSA9PT1cIik7XG4gICAgICBjb25zb2xlLmxvZyhcIlN0b3J5Ym9vayBJRDpcIiwgaW5zZXJ0ZWQuaWQpO1xuICAgICAgY29uc29sZS5sb2coXCJDb3ZlciBVUkwgc2F2ZWQ6XCIsIGluc2VydGVkLmNvdmVyX3VybCk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBjb250ZW50OiBpbnNlcnRlZCB9KTtcbiAgICAgIH0gY2F0Y2ggKHN0b3J5Ym9va0Vycm9yOiBhbnkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIj09PSBTdG9yeWJvb2sgR2VuZXJhdGlvbiBFcnJvciA9PT1cIik7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvcjpcIiwgc3Rvcnlib29rRXJyb3IpO1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiU3RhY2s6XCIsIHN0b3J5Ym9va0Vycm9yLnN0YWNrKTtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgXG4gICAgICAgICAgZXJyb3I6IHN0b3J5Ym9va0Vycm9yLm1lc3NhZ2UgfHwgXCJTdG9yeWJvb2sgZ2VuZXJhdGlvbiBmYWlsZWRcIixcbiAgICAgICAgICBkZXRhaWxzOiBzdG9yeWJvb2tFcnJvci5zdGFjaz8uc3Vic3RyaW5nKDAsIDUwMClcbiAgICAgICAgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBGb3Igb3RoZXIgdHlwZXMsIHVzZSB0ZXh0IGdlbmVyYXRpb24gd2l0aCBHZW1pbmlcbiAgICBjb25zdCBnZW5BSSA9IGdldEdlbWluaSgpO1xuICAgIGNvbnN0IG1vZGVsID0gZ2VuQUkuZ2V0R2VuZXJhdGl2ZU1vZGVsKHsgbW9kZWw6IFwiZ2VtaW5pLTIuNS1mbGFzaFwiIH0pO1xuXG4gICAgbGV0IGZ1bGxQcm9tcHQgPSBcIllvdSBhcmUgYSBoZWxwZXIgZm9yIHBhcmVudHMgb2YgeW91bmcgY2hpbGRyZW4uXFxuXFxuXCI7XG4gICAgY29uc3QgYmFzZVByb21wdCA9IGJvZHkucHJvbXB0ID8/IFwiQ3JlYXRlIGEgc3VwcG9ydGl2ZSwgYWdlLWFwcHJvcHJpYXRlIHBpZWNlIGZvciBhIHByZXNjaG9vbGVyLlwiO1xuICAgIFxuICAgIGlmIChib2R5LnR5cGUgPT09IFwic3RvcnlcIikge1xuICAgICAgZnVsbFByb21wdCArPSBgJHtiYXNlUHJvbXB0fVxcblxcbkNyZWF0ZSBhIHN1cHBvcnRpdmUgcGVyc29uYWxpemVkIHN0b3J5IGZvciBhIGNoaWxkIGFib3V0IHRoaXMgc2l0dWF0aW9uLiBSZXR1cm4gT05MWSB2YWxpZCBKU09OIGluIHRoaXMgZXhhY3QgZm9ybWF0OiB7XCJ0aXRsZVwiOiBcIlN0b3J5IFRpdGxlXCIsIFwib3V0bGluZVwiOiBbXCJwb2ludCAxXCIsIFwicG9pbnQgMlwiXSwgXCJzdG9yeV9odG1sXCI6IFwiPHA+RnVsbCBzdG9yeSBIVE1MIGhlcmU8L3A+XCJ9YDtcbiAgICB9IGVsc2UgaWYgKGJvZHkudHlwZSA9PT0gXCJzb25nX2x5cmljc1wiKSB7XG4gICAgICBmdWxsUHJvbXB0ICs9IGAke2Jhc2VQcm9tcHR9XFxuXFxuQ3JlYXRlIHBsYXlmdWwgYmVkdGltZSBzb25nIGx5cmljcyBvbmx5LiBSZXR1cm4gT05MWSB2YWxpZCBKU09OOiB7XCJ0aXRsZVwiOiBcIlNvbmcgVGl0bGVcIiwgXCJseXJpY3NcIjogXCJGdWxsIGx5cmljcyB0ZXh0XCIsIFwic3R5bGVcIjogXCJsdWxsYWJ5XCJ9YDtcbiAgICB9IGVsc2UgaWYgKGJvZHkudHlwZSA9PT0gXCJzY2hlZHVsZVwiIHx8IGJvZHkudHlwZSA9PT0gXCJjYWxlbmRhclwiKSB7XG4gICAgICBmdWxsUHJvbXB0ICs9IGAke2Jhc2VQcm9tcHR9XFxuXFxuQ3JlYXRlIGEgc2ltcGxlIHNjaGVkdWxlLiBSZXR1cm4gT05MWSB2YWxpZCBKU09OOiB7XCJ0aXRsZVwiOiBcIlNjaGVkdWxlIFRpdGxlXCIsIFwiaXRlbXNcIjogW3tcInRpbWVcIjogXCI5OjAwIEFNXCIsIFwibGFiZWxcIjogXCJBY3Rpdml0eVwifV19YDtcbiAgICB9XG5cbiAgICBmdWxsUHJvbXB0ICs9IFwiXFxuXFxuSW1wb3J0YW50OiBSZXR1cm4gT05MWSB0aGUgSlNPTiBvYmplY3QsIG5vIG1hcmtkb3duIGNvZGUgYmxvY2tzLCBubyBleHBsYW5hdGlvbiB0ZXh0LlwiO1xuXG4gICAgY29uc3QgY29tcGxldGlvbiA9IGF3YWl0IG1vZGVsLmdlbmVyYXRlQ29udGVudChmdWxsUHJvbXB0KTtcbiAgICBsZXQgdGV4dCA9IGNvbXBsZXRpb24ucmVzcG9uc2UudGV4dCgpO1xuICAgIFxuICAgIC8vIENsZWFuIHVwIG1hcmtkb3duIGNvZGUgYmxvY2tzIGlmIHByZXNlbnRcbiAgICB0ZXh0ID0gdGV4dC50cmltKCk7XG4gICAgaWYgKHRleHQuc3RhcnRzV2l0aChcImBgYGpzb25cIikpIHtcbiAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL15gYGBqc29uXFxzKi8sIFwiXCIpLnJlcGxhY2UoL1xccypgYGAkLywgXCJcIik7XG4gICAgfSBlbHNlIGlmICh0ZXh0LnN0YXJ0c1dpdGgoXCJgYGBcIikpIHtcbiAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL15gYGBcXHMqLywgXCJcIikucmVwbGFjZSgvXFxzKmBgYCQvLCBcIlwiKTtcbiAgICB9XG4gICAgXG4gICAgbGV0IHBhcnNlZDogYW55O1xuICAgIHRyeSB7XG4gICAgICBwYXJzZWQgPSBKU09OLnBhcnNlKHRleHQpO1xuICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJKU09OIHBhcnNlIGVycm9yOlwiLCBwYXJzZUVycm9yLCBcIlRleHQgd2FzOlwiLCB0ZXh0LnN1YnN0cmluZygwLCAyMDApKTtcbiAgICAgIC8vIEZhbGxiYWNrOiBjcmVhdGUgYSBzaW1wbGUgc3RydWN0dXJlXG4gICAgICBwYXJzZWQgPSB7XG4gICAgICAgIHRpdGxlOiBcIkdlbmVyYXRlZCBTdG9yeVwiLFxuICAgICAgICBvdXRsaW5lOiBbXCJJbnRyb2R1Y3Rpb25cIiwgXCJNYWluIHN0b3J5XCIsIFwiQ29uY2x1c2lvblwiXSxcbiAgICAgICAgc3RvcnlfaHRtbDogYDxwPiR7dGV4dC5yZXBsYWNlKC9cXG4vZywgXCI8L3A+PHA+XCIpfTwvcD5gLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCB7IGRhdGE6IGluc2VydGVkLCBlcnJvciB9ID0gYXdhaXQgZGJcbiAgICAgIC5mcm9tKFwiY29udGVudF9pdGVtc1wiKVxuICAgICAgLmluc2VydCh7XG4gICAgICAgIHByb2ZpbGVfaWQ6IG51bGwsXG4gICAgICAgIGNoaWxkX2lkOiBudWxsLFxuICAgICAgICB0aXRsZTogcGFyc2VkLnRpdGxlID8/IFwiR2VuZXJhdGVkXCIsXG4gICAgICAgIGNhdGVnb3J5OiBib2R5LmNhdGVnb3J5LFxuICAgICAgICB0eXBlOiBib2R5LnR5cGUsXG4gICAgICAgIGJvZHk6IHBhcnNlZCxcbiAgICAgICAgaXNfcHVibGljOiB0cnVlLFxuICAgICAgfSlcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKGVycm9yKSByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGNvbnRlbnQ6IGluc2VydGVkIH0pO1xuICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiPT09IEdlbmVyYXRlIEVycm9yID09PVwiKTtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgbWVzc2FnZTpcIiwgZS5tZXNzYWdlKTtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc3RhY2s6XCIsIGUuc3RhY2spO1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkZXRhaWxzOlwiLCBlKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBcbiAgICAgIGVycm9yOiBlLm1lc3NhZ2UgfHwgXCJHZW5lcmF0aW9uIGZhaWxlZFwiLFxuICAgICAgZGV0YWlsczogZS5zdGFjaz8uc3Vic3RyaW5nKDAsIDUwMClcbiAgICB9LCB7IHN0YXR1czogNTAwIH0pO1xuICB9XG59XG5cblxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImdldFNlcnZpY2VDbGllbnQiLCJnZXRHZW1pbmkiLCJQT1NUIiwicmVxIiwicHJvY2VzcyIsImVudiIsIkdFTUlOSV9BUElfS0VZIiwianNvbiIsImVycm9yIiwic3RhdHVzIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsImJvZHkiLCJkYiIsInR5cGUiLCJmYXZvcml0ZVRoaW5nIiwicm91dGluZUl0ZW1zIiwibGVuZ3RoIiwiZmlsdGVyIiwiaXRlbSIsInRyaW0iLCJjaGVja2xpc3ROYW1lIiwiaW1hZ2VyeURlc2NyaXB0aW9ucyIsIm1hcCIsImluZGV4IiwiaXRlbU51bSIsImlzRmlyc3QiLCJpc0xhc3QiLCJkZXNjcmlwdGlvbiIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJqb2luIiwiaW1hZ2VQcm9tcHQiLCJjb25zb2xlIiwibG9nIiwiaW1hZ2VVcmwiLCJnZW5BSSIsIm1vZGVsIiwiZ2V0R2VuZXJhdGl2ZU1vZGVsIiwiY29tcGxldGlvbiIsImdlbmVyYXRlQ29udGVudCIsInJlc3BvbnNlIiwiY2FuZGlkYXRlcyIsImJhc2U2NEltYWdlIiwiY29udGVudCIsInBhcnRzIiwicGFydCIsIk9iamVjdCIsImtleXMiLCJpbmxpbmVEYXRhIiwiZGF0YSIsIm1pbWVUeXBlIiwidGV4dCIsInN1YnN0cmluZyIsImltYWdlQnVmZmVyIiwiQnVmZmVyIiwiZnJvbSIsImZpbGVOYW1lIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInVwbG9hZERhdGEiLCJ1cGxvYWRFcnJvciIsInN0b3JhZ2UiLCJ1cGxvYWQiLCJjb250ZW50VHlwZSIsInVwc2VydCIsInVybERhdGEiLCJnZXRQdWJsaWNVcmwiLCJwdWJsaWNVcmwiLCJzdG9yYWdlRXJyb3IiLCJpbWFnZUVycm9yIiwibWVzc2FnZSIsInN0ZXBzIiwibGFiZWwiLCJ0aXAiLCJwYXJzZWQiLCJ0aXRsZSIsImltYWdlX3VybCIsImltYWdlX3Byb21wdCIsImluc2VydGVkIiwiaW5zZXJ0IiwicHJvZmlsZV9pZCIsImNoaWxkX2lkIiwiY2F0ZWdvcnkiLCJjb3Zlcl91cmwiLCJpc19wdWJsaWMiLCJzZWxlY3QiLCJzaW5nbGUiLCJkYkVycm9yIiwidGV4dE1vZGVsIiwiaW1hZ2VNb2RlbCIsImJhc2VQcm9tcHQiLCJwcm9tcHQiLCJzdG9yeVByb21wdCIsInN0b3J5Q29tcGxldGlvbiIsInN0b3J5VGV4dCIsInN0YXJ0c1dpdGgiLCJyZXBsYWNlIiwic3RvcnlEYXRhIiwiSlNPTiIsInBhcnNlIiwic3RyaW5naWZ5IiwicGFyc2VFcnJvciIsImRldGFpbHMiLCJyYXdUZXh0IiwicGFnZXMiLCJBcnJheSIsImlzQXJyYXkiLCJyZWNlaXZlZCIsInByb3RhZ29uaXN0RGVzY3JpcHRpb24iLCJwYWdlc1dpdGhJbWFnZXMiLCJjb3ZlckltYWdlVXJsIiwiZmlyc3RBdmFpbGFibGVJbWFnZVVybCIsImkiLCJwYWdlIiwicGFnZU51bWJlciIsInByb3RhZ29uaXN0RGVzYyIsInN0eWxlQ29uc2lzdGVuY3lOb3RlIiwiaW1hZ2VEZXNjcmlwdGlvbiIsImltYWdlQ29tcGxldGlvbiIsImltYWdlUmVzcG9uc2UiLCJwdXNoIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0Iiwic3Rvcnlib29rRGF0YSIsIm9yaWdpbmFsUHJvbXB0IiwiaWQiLCJzdG9yeWJvb2tFcnJvciIsInN0YWNrIiwiZnVsbFByb21wdCIsIm91dGxpbmUiLCJzdG9yeV9odG1sIiwiZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/content/generate/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/gemini.ts":
/*!***********************!*\
  !*** ./lib/gemini.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getGemini: () => (/* binding */ getGemini)\n/* harmony export */ });\n/* harmony import */ var _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @google/generative-ai */ \"(rsc)/./node_modules/@google/generative-ai/dist/index.mjs\");\n\nconst apiKey = process.env.GEMINI_API_KEY;\nfunction getGemini() {\n    return new _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.GoogleGenerativeAI(apiKey);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvZ2VtaW5pLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQTJEO0FBRTNELE1BQU1DLFNBQVNDLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYztBQUVsQyxTQUFTQztJQUNkLE9BQU8sSUFBSUwscUVBQWtCQSxDQUFDQztBQUNoQyIsInNvdXJjZXMiOlsid2VicGFjazovL2thcmFza2lkZG9zLy4vbGliL2dlbWluaS50cz9iNjM1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEdvb2dsZUdlbmVyYXRpdmVBSSB9IGZyb20gXCJAZ29vZ2xlL2dlbmVyYXRpdmUtYWlcIjtcblxuY29uc3QgYXBpS2V5ID0gcHJvY2Vzcy5lbnYuR0VNSU5JX0FQSV9LRVkhO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0R2VtaW5pKCkge1xuICByZXR1cm4gbmV3IEdvb2dsZUdlbmVyYXRpdmVBSShhcGlLZXkpO1xufVxuXG5cbiJdLCJuYW1lcyI6WyJHb29nbGVHZW5lcmF0aXZlQUkiLCJhcGlLZXkiLCJwcm9jZXNzIiwiZW52IiwiR0VNSU5JX0FQSV9LRVkiLCJnZXRHZW1pbmkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/gemini.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase/server.ts":
/*!********************************!*\
  !*** ./lib/supabase/server.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getServiceClient: () => (/* binding */ getServiceClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\nfunction getServiceClient() {\n    const url = \"https://treseoebwfddtbapyfus.supabase.co\";\n    const serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n    if (!url) {\n        throw new Error(\"NEXT_PUBLIC_SUPABASE_URL is not set\");\n    }\n    if (!serviceKey) {\n        throw new Error(\"SUPABASE_SERVICE_ROLE_KEY is not set\");\n    }\n    // Validate that the service key looks like a JWT (starts with eyJ)\n    if (!serviceKey.startsWith(\"eyJ\")) {\n        throw new Error(\"SUPABASE_SERVICE_ROLE_KEY appears to be invalid (should be a JWT token starting with 'eyJ')\");\n    }\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(url, serviceKey, {\n        auth: {\n            persistSession: false\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2Uvc2VydmVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQXFEO0FBRTlDLFNBQVNDO0lBQ2QsTUFBTUMsTUFBTUMsMENBQW9DO0lBQ2hELE1BQU1HLGFBQWFILFFBQVFDLEdBQUcsQ0FBQ0cseUJBQXlCO0lBRXhELElBQUksQ0FBQ0wsS0FBSztRQUNSLE1BQU0sSUFBSU0sTUFBTTtJQUNsQjtJQUVBLElBQUksQ0FBQ0YsWUFBWTtRQUNmLE1BQU0sSUFBSUUsTUFBTTtJQUNsQjtJQUVBLG1FQUFtRTtJQUNuRSxJQUFJLENBQUNGLFdBQVdHLFVBQVUsQ0FBQyxRQUFRO1FBQ2pDLE1BQU0sSUFBSUQsTUFBTTtJQUNsQjtJQUVBLE9BQU9SLG1FQUFZQSxDQUFDRSxLQUFLSSxZQUFZO1FBQUVJLE1BQU07WUFBRUMsZ0JBQWdCO1FBQU07SUFBRTtBQUN6RSIsInNvdXJjZXMiOlsid2VicGFjazovL2thcmFza2lkZG9zLy4vbGliL3N1cGFiYXNlL3NlcnZlci50cz82NjI1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAc3VwYWJhc2Uvc3VwYWJhc2UtanNcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldFNlcnZpY2VDbGllbnQoKSB7XG4gIGNvbnN0IHVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcbiAgY29uc3Qgc2VydmljZUtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVk7XG4gIFxuICBpZiAoIXVybCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCBpcyBub3Qgc2V0XCIpO1xuICB9XG4gIFxuICBpZiAoIXNlcnZpY2VLZXkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIGlzIG5vdCBzZXRcIik7XG4gIH1cbiAgXG4gIC8vIFZhbGlkYXRlIHRoYXQgdGhlIHNlcnZpY2Uga2V5IGxvb2tzIGxpa2UgYSBKV1QgKHN0YXJ0cyB3aXRoIGV5SilcbiAgaWYgKCFzZXJ2aWNlS2V5LnN0YXJ0c1dpdGgoXCJleUpcIikpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIGFwcGVhcnMgdG8gYmUgaW52YWxpZCAoc2hvdWxkIGJlIGEgSldUIHRva2VuIHN0YXJ0aW5nIHdpdGggJ2V5SicpXCIpO1xuICB9XG4gIFxuICByZXR1cm4gY3JlYXRlQ2xpZW50KHVybCwgc2VydmljZUtleSwgeyBhdXRoOiB7IHBlcnNpc3RTZXNzaW9uOiBmYWxzZSB9IH0pO1xufVxuXG5cbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJnZXRTZXJ2aWNlQ2xpZW50IiwidXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInNlcnZpY2VLZXkiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiRXJyb3IiLCJzdGFydHNXaXRoIiwiYXV0aCIsInBlcnNpc3RTZXNzaW9uIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase/server.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@opentelemetry","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions","vendor-chunks/@google"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcontent%2Fgenerate%2Froute&page=%2Fapi%2Fcontent%2Fgenerate%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcontent%2Fgenerate%2Froute.ts&appDir=%2FUsers%2Fkarayu%2Fprojects%2Fkaraskiddos%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fkarayu%2Fprojects%2Fkaraskiddos&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();